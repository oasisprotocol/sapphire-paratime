<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Sapphire - Sapphire Contracts Lib</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../book.css">
        <link rel="stylesheet" href="../../theme/pagetoc.css">

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Sapphire Contracts Lib</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/oasisprotocol/sapphire-paratime" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="sapphire"><a class="header" href="#sapphire">Sapphire</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/b3e9012080318b78a9cedb192e1f2467ec0b094d/contracts/contracts/Sapphire.sol">Git Source</a></p>
<p>This library provides a number of convenient wrappers for
cryptographic operations such as the x25519 key derivation, Deoxys-II-based
encryption and decryption, signing key generation, message digest signing and
verification, gas padding and hashing.
Most of the mentioned functions are implemented as Sapphire's precompiles and
are cheap to call.</p>
<h4 id="calling-precompiles-manually"><a class="header" href="#calling-precompiles-manually">Calling Precompiles Manually</a></h4>
<p>You can override the wrappers and call Sapphire precompiles by dispatching
calls to specific well-known contract addresses, as described below. The
<strong>Precompile address</strong> section of each function will show you the address
of the corresponding precompile.
Input parameters should be packed into a contiguous memory region with each
chunk of data padded to 32 bytes as usual. The recommended way to construct
parameter byte sequences in Solidity is with <code>abi.encode</code> and <code>abi.decode</code>,
which will transparently handle things like putting <code>bytes</code> lengths in the
correct position.</p>
<h2 id="state-variables"><a class="header" href="#state-variables">State Variables</a></h2>
<h3 id="random_bytes"><a class="header" href="#random_bytes">RANDOM_BYTES</a></h3>
<pre><code class="language-solidity">address internal constant RANDOM_BYTES = 0x0100000000000000000000000000000000000001;
</code></pre>
<h3 id="derive_key"><a class="header" href="#derive_key">DERIVE_KEY</a></h3>
<pre><code class="language-solidity">address internal constant DERIVE_KEY = 0x0100000000000000000000000000000000000002;
</code></pre>
<h3 id="encrypt"><a class="header" href="#encrypt">ENCRYPT</a></h3>
<pre><code class="language-solidity">address internal constant ENCRYPT = 0x0100000000000000000000000000000000000003;
</code></pre>
<h3 id="decrypt"><a class="header" href="#decrypt">DECRYPT</a></h3>
<pre><code class="language-solidity">address internal constant DECRYPT = 0x0100000000000000000000000000000000000004;
</code></pre>
<h3 id="generate_signing_keypair"><a class="header" href="#generate_signing_keypair">GENERATE_SIGNING_KEYPAIR</a></h3>
<pre><code class="language-solidity">address internal constant GENERATE_SIGNING_KEYPAIR = 0x0100000000000000000000000000000000000005;
</code></pre>
<h3 id="sign_digest"><a class="header" href="#sign_digest">SIGN_DIGEST</a></h3>
<pre><code class="language-solidity">address internal constant SIGN_DIGEST = 0x0100000000000000000000000000000000000006;
</code></pre>
<h3 id="verify_digest"><a class="header" href="#verify_digest">VERIFY_DIGEST</a></h3>
<pre><code class="language-solidity">address internal constant VERIFY_DIGEST = 0x0100000000000000000000000000000000000007;
</code></pre>
<h3 id="curve25519_public_key"><a class="header" href="#curve25519_public_key">CURVE25519_PUBLIC_KEY</a></h3>
<pre><code class="language-solidity">address internal constant CURVE25519_PUBLIC_KEY = 0x0100000000000000000000000000000000000008;
</code></pre>
<h3 id="gas_used"><a class="header" href="#gas_used">GAS_USED</a></h3>
<pre><code class="language-solidity">address internal constant GAS_USED = 0x0100000000000000000000000000000000000009;
</code></pre>
<h3 id="pad_gas"><a class="header" href="#pad_gas">PAD_GAS</a></h3>
<pre><code class="language-solidity">address internal constant PAD_GAS = 0x010000000000000000000000000000000000000a;
</code></pre>
<h3 id="sha512_256"><a class="header" href="#sha512_256">SHA512_256</a></h3>
<pre><code class="language-solidity">address internal constant SHA512_256 = 0x0100000000000000000000000000000000000101;
</code></pre>
<h3 id="sha512"><a class="header" href="#sha512">SHA512</a></h3>
<pre><code class="language-solidity">address internal constant SHA512 = 0x0100000000000000000000000000000000000102;
</code></pre>
<h3 id="sha384"><a class="header" href="#sha384">SHA384</a></h3>
<pre><code class="language-solidity">address internal constant SHA384 = 0x0100000000000000000000000000000000000104;
</code></pre>
<h2 id="functions"><a class="header" href="#functions">Functions</a></h2>
<h3 id="randombytes"><a class="header" href="#randombytes">randomBytes</a></h3>
<p>Generate <code>num_bytes</code> pseudo-random bytes, with an optional
personalization string (<code>pers</code>) added into the hashing algorithm to
increase domain separation when needed.</p>
<h4 id="precompile-address"><a class="header" href="#precompile-address">Precompile address</a></h4>
<p><code>0x0100000000000000000000000000000000000001</code></p>
<h4 id="gas-cost"><a class="header" href="#gas-cost">Gas cost</a></h4>
<p>10,000 minimum plus 240 per output word plus 60 per word of the
personalization string.</p>
<h4 id="implementation-details"><a class="header" href="#implementation-details">Implementation details</a></h4>
<p>The mode (e.g. simulation or "view call" vs transaction execution) is fed
to TupleHash (among other block-dependent components) to derive the "key
id", which is then used to derive a per-block VRF key from
epoch-ephemeral entropy (using KMAC256 and cSHAKE) so a different key
id will result in a unique per-block VRF key. This per-block VRF key is
then used to create the per-block root RNG which is then used to derive
domain-separated (using Merlin transcripts) per-transaction random RNGs
which are then exposed via this precompile. The KMAC, cSHAKE and
TupleHash algorithms are SHA-3 derived functions defined in <a href="https://nvlpubs.nist.gov/nistpubs/specialpublications/nist.sp.800-185.pdf">NIST
Special Publication 800-185</a>.</p>
<h4 id="example"><a class="header" href="#example">Example</a></h4>
<pre><code class="language-solidity">bytes memory randomPad = Sapphire.randomBytes(64, "");
</code></pre>
<pre><code class="language-solidity">function randomBytes(uint256 numBytes, bytes memory pers) internal view returns (bytes memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>numBytes</code></td><td><code>uint256</code></td><td>The number of bytes to return.</td></tr>
<tr><td><code>pers</code></td><td><code>bytes</code></td><td>An optional personalization string to increase domain separation.</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes</code></td><td>The random bytes. If the number of bytes requested is too large (over 1024), a smaller amount (1024) will be returned.</td></tr>
</tbody></table>
</div>
<h3 id="generatecurve25519keypair"><a class="header" href="#generatecurve25519keypair">generateCurve25519KeyPair</a></h3>
<p>Generates a Curve25519 keypair.</p>
<pre><code class="language-solidity">function generateCurve25519KeyPair(bytes memory pers)
    internal
    view
    returns (Curve25519PublicKey pk, Curve25519SecretKey sk);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>pers</code></td><td><code>bytes</code></td><td>An optional personalization string used to add domain separation.</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>pk</code></td><td><code>Curve25519PublicKey</code></td><td>The Curve25519 public key. Useful for key exchange.</td></tr>
<tr><td><code>sk</code></td><td><code>Curve25519SecretKey</code></td><td>The Curve25519 secret key. Pairs well with <a href="#derivesymmetrickey">deriveSymmetricKey</a>.</td></tr>
</tbody></table>
</div>
<h3 id="derivesymmetrickey"><a class="header" href="#derivesymmetrickey">deriveSymmetricKey</a></h3>
<p>Derive a symmetric key from a pair of keys using x25519.</p>
<h4 id="precompile-address-1"><a class="header" href="#precompile-address-1">Precompile address</a></h4>
<p><code>0x0100000000000000000000000000000000000002</code></p>
<h4 id="gas-cost-1"><a class="header" href="#gas-cost-1">Gas cost</a></h4>
<p>100,000</p>
<h4 id="example-1"><a class="header" href="#example-1">Example</a></h4>
<pre><code class="language-solidity">bytes32 publicKey = ... ;
bytes32 privateKey = ... ;
bytes32 symmetric = Sapphire.deriveSymmetricKey(publicKey, privateKey);
</code></pre>
<pre><code class="language-solidity">function deriveSymmetricKey(Curve25519PublicKey peerPublicKey, Curve25519SecretKey secretKey)
    internal
    view
    returns (bytes32);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>peerPublicKey</code></td><td><code>Curve25519PublicKey</code></td><td>The peer's public key.</td></tr>
<tr><td><code>secretKey</code></td><td><code>Curve25519SecretKey</code></td><td>Your secret key.</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes32</code></td><td>A derived symmetric key.</td></tr>
</tbody></table>
</div>
<h3 id="encrypt-1"><a class="header" href="#encrypt-1">encrypt</a></h3>
<p>Encrypt and authenticate the plaintext and additional data using
DeoxysII.</p>
<h4 id="precompile-address-2"><a class="header" href="#precompile-address-2">Precompile address</a></h4>
<p><code>0x0100000000000000000000000000000000000003</code></p>
<h4 id="gas-cost-2"><a class="header" href="#gas-cost-2">Gas cost</a></h4>
<p>50,000 minimum plus 100 per word of input</p>
<h4 id="example-2"><a class="header" href="#example-2">Example</a></h4>
<pre><code class="language-solidity">bytes32 key = ... ;
bytes32 nonce = ... ;
bytes memory text = "plain text";
bytes memory ad = "additional data";
bytes memory encrypted = Sapphire.encrypt(key, nonce, text, ad);
bytes memory decrypted = Sapphire.decrypt(key, nonce, encrypted, ad);
</code></pre>
<pre><code class="language-solidity">function encrypt(bytes32 key, bytes32 nonce, bytes memory plaintext, bytes memory additionalData)
    internal
    view
    returns (bytes memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>key</code></td><td><code>bytes32</code></td><td>The key to use for encryption.</td></tr>
<tr><td><code>nonce</code></td><td><code>bytes32</code></td><td>The nonce. Note that only the first 15 bytes of this parameter are used.</td></tr>
<tr><td><code>plaintext</code></td><td><code>bytes</code></td><td>The plaintext to encrypt and authenticate.</td></tr>
<tr><td><code>additionalData</code></td><td><code>bytes</code></td><td>The additional data to authenticate.</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes</code></td><td>The ciphertext with appended auth tag.</td></tr>
</tbody></table>
</div>
<h3 id="decrypt-1"><a class="header" href="#decrypt-1">decrypt</a></h3>
<p>Decrypt and authenticate the ciphertext and additional data using
DeoxysII. Reverts if the auth tag is incorrect.</p>
<h4 id="precompile-address-3"><a class="header" href="#precompile-address-3">Precompile address</a></h4>
<p><code>0x0100000000000000000000000000000000000004</code></p>
<h4 id="gas-cost-3"><a class="header" href="#gas-cost-3">Gas cost</a></h4>
<p>50,000 minimum plus 100 per word of input</p>
<h4 id="example-3"><a class="header" href="#example-3">Example</a></h4>
<pre><code class="language-solidity">bytes32 key = ... ;
bytes32 nonce = ... ;
bytes memory text = "plain text";
bytes memory ad = "additional data";
bytes memory encrypted = Sapphire.encrypt(key, nonce, text, ad);
bytes memory decrypted = Sapphire.decrypt(key, nonce, encrypted, ad);
</code></pre>
<pre><code class="language-solidity">function decrypt(bytes32 key, bytes32 nonce, bytes memory ciphertext, bytes memory additionalData)
    internal
    view
    returns (bytes memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>key</code></td><td><code>bytes32</code></td><td>The key to use for decryption.</td></tr>
<tr><td><code>nonce</code></td><td><code>bytes32</code></td><td>The nonce. Note that only the first 15 bytes of this parameter are used.</td></tr>
<tr><td><code>ciphertext</code></td><td><code>bytes</code></td><td>The ciphertext with tag to decrypt and authenticate.</td></tr>
<tr><td><code>additionalData</code></td><td><code>bytes</code></td><td>The additional data to authenticate against the ciphertext.</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes</code></td><td>The original plaintext.</td></tr>
</tbody></table>
</div>
<h3 id="generatesigningkeypair"><a class="header" href="#generatesigningkeypair">generateSigningKeyPair</a></h3>
<p>Generate a public/private key pair using the specified method and
seed. The available methods are items in the
<a href="#signingalg"><code>Sapphire.SigningAlg</code></a> enum. Note, however, that the
generation method ignores subvariants, so all three Ed25519-based are
equivalent, and all Secp256k1 &amp; Secp256r1 based methods are equivalent.
Sr25519 is not available and will return an error.</p>
<h4 id="precompile-address-4"><a class="header" href="#precompile-address-4">Precompile address</a></h4>
<p><code>0x0100000000000000000000000000000000000005</code></p>
<h4 id="gas-cost-4"><a class="header" href="#gas-cost-4">Gas Cost</a></h4>
<h5 id="ed25519-1000-gas"><a class="header" href="#ed25519-1000-gas">Ed25519: 1,000 gas</a></h5>
<ul>
<li><code>0</code> (<code>Ed25519Oasis</code>)</li>
<li><code>1</code> (<code>Ed25519Pure</code>)</li>
<li><code>2</code> (<code>Ed25519PrehashedSha512</code>)</li>
</ul>
<h5 id="secp256k1-1500-gas"><a class="header" href="#secp256k1-1500-gas">Secp256k1: 1,500 gas.</a></h5>
<ul>
<li><code>3</code> (<code>Secp256k1Oasis</code>)</li>
<li><code>4</code> (<code>Secp256k1PrehashedKeccak256</code>)</li>
<li><code>5</code> (<code>Secp256k1PrehashedSha256</code>)</li>
</ul>
<h5 id="secp256r1-4000-gas"><a class="header" href="#secp256r1-4000-gas">Secp256r1: 4,000 gas</a></h5>
<ul>
<li><code>7</code> (<code>Secp256r1PrehashedSha256</code>)</li>
</ul>
<h5 id="secp384r1-18000-gas"><a class="header" href="#secp384r1-18000-gas">Secp384r1: 18,000 gas</a></h5>
<ul>
<li><code>8</code> (<code>Secp384r1PrehashedSha384</code>)</li>
</ul>
<h4 id="key-formats"><a class="header" href="#key-formats">Key Formats</a></h4>
<h5 id="ed25519"><a class="header" href="#ed25519">Ed25519</a></h5>
<p>Public key: 32 bytes
Secret key: 32 bytes</p>
<h5 id="secp256k1--secp256r1"><a class="header" href="#secp256k1--secp256r1">Secp256k1 &amp; Secp256r1</a></h5>
<p>Public key: 33 bytes, compressed format (<code>0x02</code> or <code>0x03</code> prefix, then 32
byte X coordinate).
Secret key: 32 bytes</p>
<h5 id="secp384r1"><a class="header" href="#secp384r1">Secp384r1</a></h5>
<p>Public key: 49 bytes, compressed format (<code>0x02</code> or <code>0x03</code> prefix, then 48
byte X coordinate).
Secret key: 48 bytes</p>
<h4 id="example-4"><a class="header" href="#example-4">Example</a></h4>
<pre><code class="language-solidity">bytes memory seed = hex"0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef";
bytes memory publicKey;
bytes memory privateKey;
(publicKey, privateKey) = Sapphire.generateSigningKeyPair(Sapphire.SigningAlg.Ed25519Pure, seed);
</code></pre>
<pre><code class="language-solidity">function generateSigningKeyPair(SigningAlg alg, bytes memory seed)
    internal
    view
    returns (bytes memory publicKey, bytes memory secretKey);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>alg</code></td><td><code>SigningAlg</code></td><td>The signing alg for which to generate a keypair.</td></tr>
<tr><td><code>seed</code></td><td><code>bytes</code></td><td>The seed to use for generating the key pair. You can use the <code>randomBytes</code> method if you don't already have a seed.</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>publicKey</code></td><td><code>bytes</code></td><td>The public part of the keypair.</td></tr>
<tr><td><code>secretKey</code></td><td><code>bytes</code></td><td>The secret part of the keypair.</td></tr>
</tbody></table>
</div>
<h3 id="sign"><a class="header" href="#sign">sign</a></h3>
<p>Sign a message within the provided context using the specified
algorithm, and return the signature. The <code>contextOrHash</code> and
<code>message</code> parameters change in meaning slightly depending on the algorithm
requested:
For algorithms that use domain-separation contexts:</p>
<ul>
<li>Ed25519Oasis and Secp256k1Oasis: Pass the domain separator context string as
<code>contextOrHash</code> and the message to sign as <code>message</code>.
For algorithms that use pre-computed hashes:</li>
<li>Ed25519PrehashedSha512: Pass the SHA-512 hash (64 bytes) as <code>contextOrHash</code>
and set <code>message</code> to empty.</li>
<li>Secp256k1PrehashedKeccak256: Pass the Keccak256 hash (32 bytes) as <code>contextOrHash</code>
and set <code>message</code> to empty. The hash should be computed as <code>bytes memory hash = abi.encodePacked(keccak256(message))</code>.</li>
<li>Secp256k1PrehashedSha256: Pass the SHA-256 hash (32 bytes) as <code>contextOrHash</code>
and set <code>message</code> to empty.</li>
<li>Secp256r1PrehashedSha256: Pass the SHA-256 hash (32 bytes) as <code>contextOrHash</code>
and set <code>message</code> to empty.</li>
<li>Secp384r1PrehashedSha384: Pass the SHA-384 hash (48 bytes) as <code>contextOrHash</code>
and set <code>message</code> to empty.
For Sr25519 signatures (for Substrate compatibility):</li>
<li>Sr25519: You MUST pass "substrate" as the <code>contextOrHash</code> parameter to ensure
compatibility with Substrate off-chain signing that uses the <code>{ withType: true }</code>
parameter. Pass the message to sign as the <code>message</code> parameter.</li>
</ul>
<h4 id="precompile-address-5"><a class="header" href="#precompile-address-5">Precompile address</a></h4>
<p><code>0x0100000000000000000000000000000000000006</code></p>
<h4 id="gas-cost-5"><a class="header" href="#gas-cost-5">Gas cost</a></h4>
<p>See below for the method-dependent base cost, plus 8 gas per 32 bytes of
context and message except digest.</p>
<h4 id="signing-algorithms"><a class="header" href="#signing-algorithms">Signing algorithms</a></h4>
<ul>
<li><code>0</code> (<code>Ed25519Oasis</code>): 1,500 gas, variable length context and message.</li>
<li><code>1</code> (<code>Ed25519Pure</code>): 1,500 gas, empty context, variable length message.</li>
<li><code>2</code> (<code>Ed25519PrehashedSha512</code>): 1,500 gas, pre-existing SHA-512 hash
(64 bytes) as context, empty message.</li>
<li><code>3</code> (<code>Secp256k1Oasis</code>): 3,000 gas, variable length context and message</li>
<li><code>4</code> (<code>Secp256k1PrehashedKeccak256</code>): 3,000 gas, pre-existing hash
(32 bytes) as context, empty message.</li>
<li><code>5</code> (<code>Secp256k1PrehashedSha256</code>): 3,000 gas, pre-existing hash (32
bytes) as context, empty message.</li>
<li><code>7</code> (<code>Secp256r1PrehashedSha256</code>): 9,000 gas, pre-existing hash (32
bytes) as context, empty message.</li>
<li><code>8</code> (<code>Secp384r1PrehashedSha384</code>): 43,200 gas, pre-existing hash (48
bytes) as context, empty message.</li>
</ul>
<h4 id="example-5"><a class="header" href="#example-5">Example</a></h4>
<pre><code class="language-solidity">// Example 1: Signing with Ed25519Pure
Sapphire.SigningAlg alg = Sapphire.SigningAlg.Ed25519Pure;
bytes memory pk;
bytes memory sk;
(pk, sk) = Sapphire.generateSigningKeyPair(alg, Sapphire.randomBytes(32, ""));
bytes memory signature = Sapphire.sign(alg, sk, "", "signed message");
// Example 2: Signing with Secp256k1PrehashedKeccak256
alg = Sapphire.SigningAlg.Secp256k1PrehashedKeccak256;
bytes memory message = "message to sign";
bytes memory digest = abi.encodePacked(keccak256(message));
signature = Sapphire.sign(alg, sk, digest, "");
// Example 3: Signing with Sr25519 (Substrate compatibility)
alg = Sapphire.SigningAlg.Sr25519;
bytes memory message = "message to sign";
signature = Sapphire.sign(alg, sk, "substrate", message);
</code></pre>
<p><strong>Note:</strong>
see: @oasisprotocol/oasis-sdk :: precompile/confidential.rs :: call_sign</p>
<pre><code class="language-solidity">function sign(SigningAlg alg, bytes memory secretKey, bytes memory contextOrHash, bytes memory message)
    internal
    view
    returns (bytes memory signature);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>alg</code></td><td><code>SigningAlg</code></td><td>The signing algorithm to use.</td></tr>
<tr><td><code>secretKey</code></td><td><code>bytes</code></td><td>The secret key to use for signing. The key must be valid for use with the requested algorithm.</td></tr>
<tr><td><code>contextOrHash</code></td><td><code>bytes</code></td><td>Domain-Separator Context, or precomputed hash bytes. The format and meaning depends on the selected algorithm (see above).</td></tr>
<tr><td><code>message</code></td><td><code>bytes</code></td><td>Message to sign, should be zero-length if precomputed hash given.</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>signature</code></td><td><code>bytes</code></td><td>The resulting signature.</td></tr>
</tbody></table>
</div>
<h3 id="verify"><a class="header" href="#verify">verify</a></h3>
<p>Verifies that the provided digest was signed using the
secret key corresponding to the provided public key and the specified
signing algorithm.
The <code>contextOrHash</code> and <code>message</code> parameters behave the same way as in the
sign() function. Please refer to the <a href="#sign">sign()</a> function documentation
for details on how these parameters should be used with each algorithm.</p>
<h4 id="precompile-address-6"><a class="header" href="#precompile-address-6">Precompile address</a></h4>
<p><code>0x0100000000000000000000000000000000000007</code></p>
<h4 id="gas-cost-6"><a class="header" href="#gas-cost-6">Gas cost</a></h4>
<p>The algorithm-specific base cost below, with an additional <strong>8 gas per
32 bytes</strong> of <code>context</code> and <code>message</code> for the <code>Ed25519Oasis</code>,
<code>Ed25519Pure</code> and <code>Secp256k1Oasis</code> algorithms.</p>
<ul>
<li><code>0</code> (<code>Ed25519Oasis</code>): 2,000 gas</li>
<li><code>1</code> (<code>Ed25519Pure</code>): 2,000 gas</li>
<li><code>2</code> (<code>Ed25519PrehashedSha512</code>): 2,000 gas</li>
<li><code>3</code> (<code>Secp256k1Oasis</code>): 3,000 gas</li>
<li><code>4</code> (<code>Secp256k1PrehashedKeccak256</code>): 3,000 gas</li>
<li><code>5</code> (<code>Secp256k1PrehashedSha256</code>): 3,000 gas</li>
<li><code>7</code> (<code>Secp256r1PrehashedSha256</code>): 7,900 gas</li>
<li><code>8</code> (<code>Secp384r1PrehashedSha384</code>): 37,920 gas</li>
</ul>
<h4 id="example-6"><a class="header" href="#example-6">Example</a></h4>
<pre><code class="language-solidity">// Example 1: Verifying with Secp256k1PrehashedKeccak256
Sapphire.SigningAlg alg = Sapphire.SigningAlg.Secp256k1PrehashedKeccak256;
bytes memory pk;
bytes memory sk;
bytes memory message = "message to sign";
// Create the hash
bytes memory digest = abi.encodePacked(keccak256(message));
// Generate keys and sign
(pk, sk) = Sapphire.generateSigningKeyPair(alg, Sapphire.randomBytes(32, ""));
bytes memory signature = Sapphire.sign(alg, sk, digest, "");
// Verify the signature (pass the same hash used for signing)
bool isValid = Sapphire.verify(alg, pk, digest, "", signature);
require(isValid, "Invalid signature");
// Example 2: Verifying with Sr25519 (Substrate compatibility)
alg = Sapphire.SigningAlg.Sr25519;
message = "message to sign";
// Sign with "substrate" context
signature = Sapphire.sign(alg, sk, "substrate", message);
// Verify with the same "substrate" context
isValid = Sapphire.verify(alg, pk, "substrate", message, signature);
require(isValid, "Invalid signature");
</code></pre>
<p><strong>Note:</strong>
see: @oasisprotocol/oasis-sdk :: precompile/confidential.rs :: call_verify</p>
<pre><code class="language-solidity">function verify(
    SigningAlg alg,
    bytes memory publicKey,
    bytes memory contextOrHash,
    bytes memory message,
    bytes memory signature
) internal view returns (bool verified);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>alg</code></td><td><code>SigningAlg</code></td><td>The signing algorithm by which the signature was generated.</td></tr>
<tr><td><code>publicKey</code></td><td><code>bytes</code></td><td>The public key against which to check the signature.</td></tr>
<tr><td><code>contextOrHash</code></td><td><code>bytes</code></td><td>Domain-Separator Context, or precomputed hash bytes. The format and meaning depends on the selected algorithm (see above).</td></tr>
<tr><td><code>message</code></td><td><code>bytes</code></td><td>The message that was signed, should be zero-length if precomputed hash was given in contextOrHash.</td></tr>
<tr><td><code>signature</code></td><td><code>bytes</code></td><td>The signature to verify.</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>verified</code></td><td><code>bool</code></td><td>Whether the signature is valid for the given parameters.</td></tr>
</tbody></table>
</div>
<h3 id="padgas"><a class="header" href="#padgas">padGas</a></h3>
<p>Set the current transactions gas usage to a specific amount</p>
<p><em>Will cause a reversion if the current usage is more than the amount.</em></p>
<p><strong>Note:</strong>
see: @oasisprotocol/oasis-sdk :: precompile/gas.rs :: call_pad_gas</p>
<pre><code class="language-solidity">function padGas(uint128 toAmount) internal view;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>toAmount</code></td><td><code>uint128</code></td><td>Gas usage will be set to this amount</td></tr>
</tbody></table>
</div>
<h3 id="gasused"><a class="header" href="#gasused">gasUsed</a></h3>
<p>Returns the amount of gas currently used by the transaction</p>
<p><strong>Note:</strong>
see: @oasisprotocol/oasis-sdk :: precompile/gas.rs :: call_gas_used</p>
<pre><code class="language-solidity">function gasUsed() internal view returns (uint64);
</code></pre>
<h2 id="enums"><a class="header" href="#enums">Enums</a></h2>
<h3 id="signingalg"><a class="header" href="#signingalg">SigningAlg</a></h3>
<pre><code class="language-solidity">enum SigningAlg {
    Ed25519Oasis,
    Ed25519Pure,
    Ed25519PrehashedSha512,
    Secp256k1Oasis,
    Secp256k1PrehashedKeccak256,
    Secp256k1PrehashedSha256,
    Sr25519,
    Secp256r1PrehashedSha256,
    Secp384r1PrehashedSha384
}
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../contracts/RLPWriter.sol/library.RLPWriter.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../contracts/Sapphire.sol/function.sha384.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../contracts/RLPWriter.sol/library.RLPWriter.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../contracts/Sapphire.sol/function.sha384.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../solidity.min.js"></script>
        <script src="../../theme/pagetoc.js"></script>



    </div>
    </body>
</html>
