<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Sapphire Contracts Lib</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="book.css">
        <link rel="stylesheet" href="theme/pagetoc.css">

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Sapphire Contracts Lib</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/oasisprotocol/sapphire-paratime" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="sapphire-contracts-lib"><a class="header" href="#sapphire-contracts-lib">Sapphire Contracts Lib</a></h1>
<p><a href="https://www.npmjs.com/package/@oasisprotocol/sapphire-contracts">NPM</a> <img src="https://img.shields.io/npm/v/@oasisprotocol/sapphire-contracts" alt="npm" /></p>
<p><strong>A library for privacy focused smart contract development.</strong></p>
<ul>
<li>Implementations of OPL smart contracts</li>
<li>Sapphire library precompiles and cryptographic primitives</li>
<li>Wrapped Rose example</li>
</ul>
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<h4 id="installation"><a class="header" href="#installation">Installation</a></h4>
<pre><code class="language-solidity">$ pnpm install @oasisprotocol/sapphire-contracts
</code></pre>
<h4 id="usage"><a class="header" href="#usage">Usage</a></h4>
<p>Once installed, you can import and use the Sapphire contracts as follows:</p>
<pre><code class="language-solidity">pragma solidity ^0.8.13;

import {Sapphire} from "@oasisprotocol/sapphire-contracts/contracts/Sapphire.sol";

contract RandomNumber {
    function generateNumber() public view returns (uint) {
        return uint(bytes32(Sapphire.randomBytes(32, "")));
    }
}
</code></pre>
<h2 id="documentation"><a class="header" href="#documentation">Documentation</a></h2>
<p>See the user's guide for <a href="https://docs.oasis.io/build/sapphire/">Sapphire</a> and
<a href="https://docs.oasis.io/build/opl/">OPL</a>.</p>
<p>The generated API reference is hosted at
<a href="https://api.docs.oasis.io/sol/sapphire-contracts">api.docs.oasis.io</a>.</p>
<p>Generating API docs locally requires Foundry and mdbook-pagetoc. To install
them and generate the docs execute:</p>
<pre><code class="language-shell">curl -L https://foundry.paradigm.xyz | bash
cargo install mdbook-pagetoc
pnpm doc
</code></pre>
<p>The API docs index will be located in <code>sol/sapphire-contracts/book/index.html</code>.</p>
<h2 id="contribute"><a class="header" href="#contribute">Contribute</a></h2>
<p>There are many ways you can participate and help build high quality software.
Check out the <a href="https://github.com/oasisprotocol/sapphire-paratime/blob/main/CONTRIBUTING.md">contribution guide</a>!</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="contents"><a class="header" href="#contents">Contents</a></h1>
<ul>
<li><a href="contracts/auth/A13e.sol/abstract.A13e.html">A13e</a></li>
<li><a href="contracts/auth/SiweAuth.sol/struct.AuthToken.html">AuthToken</a></li>
<li><a href="contracts/auth/SiweAuth.sol/contract.SiweAuth.html">SiweAuth</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="a13e"><a class="header" href="#a13e">A13e</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/auth/A13e.sol">Git Source</a></p>
<p><strong>Title:</strong>
Interface for authenticatable contracts</p>
<p>This is the interface for universal authentication mechanism (e.g.
SIWE):</p>
<ol>
<li>The user-facing app calls <code>login()</code> which generates the authentication
token on-chain.</li>
<li>Any smart contract method that requires authentication can take this token
as an argument. Passing this token to <code>authMsgSender()</code> verifies it and
returns the <strong>authenticated</strong> user address. This verified address can then
serve as a user ID for authorization.</li>
</ol>
<h2 id="state-variables"><a class="header" href="#state-variables">State Variables</a></h2>
<h3 id="_revokedauthtokens"><a class="header" href="#_revokedauthtokens">_revokedAuthTokens</a></h3>
<p>A mapping of revoked authentication tokens. Access it directly or use the checkRevokedAuthToken modifier.</p>
<pre><code class="language-solidity">mapping(bytes32 =&gt; bool) internal _revokedAuthTokens
</code></pre>
<h2 id="functions"><a class="header" href="#functions">Functions</a></h2>
<h3 id="checkrevokedauthtoken"><a class="header" href="#checkrevokedauthtoken">checkRevokedAuthToken</a></h3>
<p>Reverts if the given token was revoked</p>
<pre><code class="language-solidity">modifier checkRevokedAuthToken(bytes memory token) ;
</code></pre>
<h3 id="login"><a class="header" href="#login">login</a></h3>
<p>Verify the login message and its signature and generate the
token.</p>
<pre><code class="language-solidity">function login(string calldata message, SignatureRSV calldata sig) external view virtual returns (bytes memory);
</code></pre>
<h3 id="authmsgsender"><a class="header" href="#authmsgsender">authMsgSender</a></h3>
<p>Validate the token and return authenticated msg.sender.</p>
<pre><code class="language-solidity">function authMsgSender(bytes memory token) internal view virtual returns (address);
</code></pre>
<h3 id="revokeauthtoken"><a class="header" href="#revokeauthtoken">revokeAuthToken</a></h3>
<p>Revoke the authentication token with the corresponding hash.
e.g. In case when the token is leaked or for extra-secure apps on
every logout.</p>
<pre><code class="language-solidity">function revokeAuthToken(bytes32 token) internal;
</code></pre>
<h2 id="errors"><a class="header" href="#errors">Errors</a></h2>
<h3 id="a13e_revokedauthtoken"><a class="header" href="#a13e_revokedauthtoken">A13e_RevokedAuthToken</a></h3>
<p>The authentication token was revoked</p>
<pre><code class="language-solidity">error A13e_RevokedAuthToken();
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="authtoken"><a class="header" href="#authtoken">AuthToken</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/auth/SiweAuth.sol">Git Source</a></p>
<p><strong>Title:</strong>
AuthToken structure for SIWE-based authentication</p>
<pre><code class="language-solidity">struct AuthToken {
string domain; // [ scheme "://" ] domain.
address userAddr;
uint256 validUntil; // in Unix timestamp.
string statement; // Human-readable statement from the SIWE message.
string[] resources; // Resources this token grants access to.
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="siweauth"><a class="header" href="#siweauth">SiweAuth</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/auth/SiweAuth.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
<a href="contracts/auth/SiweAuth.sol//contracts/auth/A13e.sol/abstract.A13e.html">A13e</a></p>
<p><strong>Title:</strong>
Base contract for SIWE-based authentication</p>
<p>Inherit this contract if you wish to enable SIWE-based
authentication in your contract functions that require authentication.
The smart contract needs to be bound to a domain (passed in constructor).</p>
<h4 id="example"><a class="header" href="#example">Example</a></h4>
<pre><code class="language-solidity">contract MyContract is SiweAuth {
address private _owner;
string private _message;
modifier onlyOwner(bytes memory token) {
if (msg.sender != _owner &amp;&amp; authMsgSender(token) != _owner) {
revert("not allowed");
}
_;
}
constructor(string memory domain) SiweAuth(domain) {
_owner = msg.sender;
}
function getSecretMessage(bytes memory token) external view onlyOwner(token) returns (string memory) {
return _message;
}
function setSecretMessage(string calldata message) external onlyOwner("") {
_message = message;
}
}
</code></pre>
<h2 id="state-variables-1"><a class="header" href="#state-variables-1">State Variables</a></h2>
<h3 id="_domain"><a class="header" href="#_domain">_domain</a></h3>
<p>Domain which the dApp is associated with</p>
<pre><code class="language-solidity">string internal _domain
</code></pre>
<h3 id="_authtokenenckey"><a class="header" href="#_authtokenenckey">_authTokenEncKey</a></h3>
<p>Encryption key which the authentication tokens are encrypted with</p>
<pre><code class="language-solidity">bytes32 private _authTokenEncKey
</code></pre>
<h3 id="default_validity"><a class="header" href="#default_validity">DEFAULT_VALIDITY</a></h3>
<p>Default authentication token validity, if no expiration-time provided</p>
<pre><code class="language-solidity">uint256 private constant DEFAULT_VALIDITY = 24 hours
</code></pre>
<h2 id="functions-1"><a class="header" href="#functions-1">Functions</a></h2>
<h3 id="constructor"><a class="header" href="#constructor">constructor</a></h3>
<p>Instantiate the contract which uses SIWE for authentication and
runs on the specified domain.</p>
<pre><code class="language-solidity">constructor(string memory inDomain) ;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>inDomain</code></td><td><code>string</code></td><td>The domain this contract is associated with</td></tr>
</tbody></table>
</div>
<h3 id="login-1"><a class="header" href="#login-1">login</a></h3>
<p>Login using a SIWE message and signature</p>
<pre><code class="language-solidity">function login(string calldata siweMsg, SignatureRSV calldata sig) external view override returns (bytes memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>siweMsg</code></td><td><code>string</code></td><td>The signed SIWE message</td></tr>
<tr><td><code>sig</code></td><td><code>SignatureRSV</code></td><td>The signature of the SIWE message</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes</code></td><td>The encrypted authentication token</td></tr>
</tbody></table>
</div>
<h3 id="domain"><a class="header" href="#domain">domain</a></h3>
<p>Return the domain associated with the dApp.</p>
<pre><code class="language-solidity">function domain() public view returns (string memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>string</code></td><td>The domain string</td></tr>
</tbody></table>
</div>
<h3 id="authmsgsender-1"><a class="header" href="#authmsgsender-1">authMsgSender</a></h3>
<p>Get the authenticated address from a token</p>
<pre><code class="language-solidity">function authMsgSender(bytes memory token) internal view override checkRevokedAuthToken(token) returns (address);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>token</code></td><td><code>bytes</code></td><td>The authentication token</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>The authenticated user address or zero address if token is empty</td></tr>
</tbody></table>
</div>
<h3 id="getstatement"><a class="header" href="#getstatement">getStatement</a></h3>
<p>Get the statement from the authentication token</p>
<pre><code class="language-solidity">function getStatement(bytes memory token) internal view checkRevokedAuthToken(token) returns (string memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>token</code></td><td><code>bytes</code></td><td>The authentication token</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>string</code></td><td>The statement string from the SIWE message</td></tr>
</tbody></table>
</div>
<h3 id="getresources"><a class="header" href="#getresources">getResources</a></h3>
<p>Get all resources from the authentication token</p>
<pre><code class="language-solidity">function getResources(bytes memory token) internal view checkRevokedAuthToken(token) returns (string[] memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>token</code></td><td><code>bytes</code></td><td>The authentication token</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>string[]</code></td><td>Array of resource URIs the token grants access to</td></tr>
</tbody></table>
</div>
<h3 id="decodeandvalidatetoken"><a class="header" href="#decodeandvalidatetoken">decodeAndValidateToken</a></h3>
<p>Helper function to decrypt, decode and validate a token</p>
<p>Performs token decoding as well as domain and validation</p>
<pre><code class="language-solidity">function decodeAndValidateToken(bytes memory token) internal view virtual returns (AuthToken memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>token</code></td><td><code>bytes</code></td><td>The authentication token</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>AuthToken</code></td><td>The decoded and validated AuthToken struct</td></tr>
</tbody></table>
</div>
<h2 id="errors-1"><a class="header" href="#errors-1">Errors</a></h2>
<h3 id="siweauth_chainidmismatch"><a class="header" href="#siweauth_chainidmismatch">SiweAuth_ChainIdMismatch</a></h3>
<p>Chain ID in the SIWE message does not match the actual chain ID</p>
<pre><code class="language-solidity">error SiweAuth_ChainIdMismatch();
</code></pre>
<h3 id="siweauth_domainmismatch"><a class="header" href="#siweauth_domainmismatch">SiweAuth_DomainMismatch</a></h3>
<p>Domain in the SIWE message does not match the domain of a dApp</p>
<pre><code class="language-solidity">error SiweAuth_DomainMismatch();
</code></pre>
<h3 id="siweauth_addressmismatch"><a class="header" href="#siweauth_addressmismatch">SiweAuth_AddressMismatch</a></h3>
<p>User address in the SIWE message does not match the message signer's address</p>
<pre><code class="language-solidity">error SiweAuth_AddressMismatch();
</code></pre>
<h3 id="siweauth_notbeforeinfuture"><a class="header" href="#siweauth_notbeforeinfuture">SiweAuth_NotBeforeInFuture</a></h3>
<p>The Not before value in the SIWE message is still in the future</p>
<pre><code class="language-solidity">error SiweAuth_NotBeforeInFuture();
</code></pre>
<h3 id="siweauth_expired"><a class="header" href="#siweauth_expired">SiweAuth_Expired</a></h3>
<p>Validity of the authentication token or the Expires value in the SIWE message is in the past</p>
<pre><code class="language-solidity">error SiweAuth_Expired();
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="contents-1"><a class="header" href="#contents-1">Contents</a></h1>
<ul>
<li><a href="contracts/opl/Enclave.sol/contract.Enclave.html">Enclave</a></li>
<li><a href="contracts/opl/Endpoint.sol/error.AutoConfigUnavailable.html">AutoConfigUnavailable</a></li>
<li><a href="contracts/opl/Endpoint.sol/error.MissingRemoteAddr.html">MissingRemoteAddr</a></li>
<li><a href="contracts/opl/Endpoint.sol/error.MissingRemoteChainId.html">MissingRemoteChainId</a></li>
<li><a href="contracts/opl/Endpoint.sol/error.SelfCallDisallowed.html">SelfCallDisallowed</a></li>
<li><a href="contracts/opl/Endpoint.sol/error.UnknownEndpoint.html">UnknownEndpoint</a></li>
<li><a href="contracts/opl/Endpoint.sol/enum.Result.html">Result</a></li>
<li><a href="contracts/opl/Endpoint.sol/interface.ICelerMessageBus.html">ICelerMessageBus</a></li>
<li><a href="contracts/opl/Endpoint.sol/contract.BaseEndpoint.html">BaseEndpoint</a></li>
<li><a href="contracts/opl/Endpoint.sol/contract.Endpoint.html">Endpoint</a></li>
<li><a href="contracts/opl/Endpoint.sol/function._getBus.html">_getBus</a></li>
<li><a href="contracts/opl/Endpoint.sol/function._getChainConfig.html">_getChainConfig</a></li>
<li><a href="contracts/opl/Endpoint.sol/function._chainName2ChainId.html">_chainName2ChainId</a></li>
<li><a href="contracts/opl/Endpoint.sol/function._getRemoteChainId.html">_getRemoteChainId</a></li>
<li><a href="contracts/opl/Endpoint.sol/function.autoswitch.html">autoswitch</a></li>
<li><a href="contracts/opl/Host.sol/contract.Host.html">Host</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="enclave"><a class="header" href="#enclave">Enclave</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/opl/Enclave.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
<a href="contracts/opl/Enclave.sol//contracts/opl/Endpoint.sol/contract.Endpoint.html">Endpoint</a></p>
<p><strong>Title:</strong>
OPL Enclave</p>
<p>The Sapphire-side of an OPL dApp.</p>
<h2 id="functions-2"><a class="header" href="#functions-2">Functions</a></h2>
<h3 id="constructor-1"><a class="header" href="#constructor-1">constructor</a></h3>
<pre><code class="language-solidity">constructor(address _host, bytes32 _hostChain) Endpoint(_host, _hostChain);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="autoconfigunavailable"><a class="header" href="#autoconfigunavailable">AutoConfigUnavailable</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/opl/Endpoint.sol">Git Source</a></p>
<p>Unable to automatically configure OPL. Please use the manual version of the base contract.</p>
<pre><code class="language-solidity">error AutoConfigUnavailable();
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="missingremoteaddr"><a class="header" href="#missingremoteaddr">MissingRemoteAddr</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/opl/Endpoint.sol">Git Source</a></p>
<p>The remote endpoint's contract address was missing.</p>
<pre><code class="language-solidity">error MissingRemoteAddr();
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="missingremotechainid"><a class="header" href="#missingremotechainid">MissingRemoteChainId</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/opl/Endpoint.sol">Git Source</a></p>
<p>The remote endpoint's chain ID was missing.</p>
<pre><code class="language-solidity">error MissingRemoteChainId();
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="selfcalldisallowed"><a class="header" href="#selfcalldisallowed">SelfCallDisallowed</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/opl/Endpoint.sol">Git Source</a></p>
<p>Calls to contracts on the same chain are not allowed unless on a local testnet.</p>
<pre><code class="language-solidity">error SelfCallDisallowed();
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="unknownendpoint"><a class="header" href="#unknownendpoint">UnknownEndpoint</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/opl/Endpoint.sol">Git Source</a></p>
<p>The requested endpoint does not exist.</p>
<pre><code class="language-solidity">error UnknownEndpoint();
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="result"><a class="header" href="#result">Result</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/opl/Endpoint.sol">Git Source</a></p>
<p>The outcome of the message call.</p>
<pre><code class="language-solidity">enum Result {
// The message was rejected.
PermanentFailure,
// The message was rejected but may be accepted later.
TransientFailure,
// The message was accepted and processed.
Success
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="icelermessagebus"><a class="header" href="#icelermessagebus">ICelerMessageBus</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/opl/Endpoint.sol">Git Source</a></p>
<h2 id="functions-3"><a class="header" href="#functions-3">Functions</a></h2>
<h3 id="feebase"><a class="header" href="#feebase">feeBase</a></h3>
<pre><code class="language-solidity">function feeBase() external view returns (uint256);
</code></pre>
<h3 id="feeperbyte"><a class="header" href="#feeperbyte">feePerByte</a></h3>
<pre><code class="language-solidity">function feePerByte() external view returns (uint256);
</code></pre>
<h3 id="sendmessage"><a class="header" href="#sendmessage">sendMessage</a></h3>
<pre><code class="language-solidity">function sendMessage(address _host, uint256 _hostChainId, bytes calldata _message) external payable;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="baseendpoint"><a class="header" href="#baseendpoint">BaseEndpoint</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/opl/Endpoint.sol">Git Source</a></p>
<h2 id="state-variables-2"><a class="header" href="#state-variables-2">State Variables</a></h2>
<h3 id="messagebus"><a class="header" href="#messagebus">messageBus</a></h3>
<pre><code class="language-solidity">address internal immutable messageBus
</code></pre>
<h3 id="inorder"><a class="header" href="#inorder">inOrder</a></h3>
<pre><code class="language-solidity">bool private immutable inOrder
</code></pre>
<h3 id="remote"><a class="header" href="#remote">remote</a></h3>
<pre><code class="language-solidity">address private remote
</code></pre>
<h3 id="remotechainid"><a class="header" href="#remotechainid">remoteChainId</a></h3>
<pre><code class="language-solidity">uint256 private remoteChainId
</code></pre>
<h3 id="endpoints"><a class="header" href="#endpoints">endpoints</a></h3>
<pre><code class="language-solidity">mapping(bytes32 =&gt; function(bytes calldata) returns (Result)) private endpoints
</code></pre>
<h3 id="txseq"><a class="header" href="#txseq">txSeq</a></h3>
<pre><code class="language-solidity">uint256 private txSeq
</code></pre>
<h3 id="rxseq"><a class="header" href="#rxseq">rxSeq</a></h3>
<pre><code class="language-solidity">uint256 private rxSeq
</code></pre>
<h2 id="functions-4"><a class="header" href="#functions-4">Functions</a></h2>
<h3 id="constructor-2"><a class="header" href="#constructor-2">constructor</a></h3>
<pre><code class="language-solidity">constructor(address _remote, uint256 _remoteChainId, address _messageBus, bool _inOrder) ;
</code></pre>
<h3 id="registerendpoint"><a class="header" href="#registerendpoint">registerEndpoint</a></h3>
<pre><code class="language-solidity">function registerEndpoint(bytes memory _method, function(bytes calldata) returns (Result) _cb) internal;
</code></pre>
<h3 id="postmessage"><a class="header" href="#postmessage">postMessage</a></h3>
<pre><code class="language-solidity">function postMessage(bytes memory _method) internal returns (uint256);
</code></pre>
<h3 id="postmessage-1"><a class="header" href="#postmessage-1">postMessage</a></h3>
<p>Calls the remote endpoint, returning the amount of native token charged for the operation.</p>
<pre><code class="language-solidity">function postMessage(bytes memory _method, bytes memory _message) internal returns (uint256);
</code></pre>
<h3 id="executemessage"><a class="header" href="#executemessage">executeMessage</a></h3>
<p>Celer message bus callback function.</p>
<pre><code class="language-solidity">function executeMessage(
    address _sender,
    uint64 _senderChainId,
    bytes calldata _message,
    address // executor
)
    external
    payable
    returns (uint256);
</code></pre>
<h3 id="estimatefee"><a class="header" href="#estimatefee">estimateFee</a></h3>
<pre><code class="language-solidity">function estimateFee(uint256 _msgLen) internal view returns (uint256);
</code></pre>
<h3 id="_islocalnetwork"><a class="header" href="#_islocalnetwork">_isLocalNetwork</a></h3>
<pre><code class="language-solidity">function _isLocalNetwork() internal view returns (bool);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="endpoint"><a class="header" href="#endpoint">Endpoint</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/opl/Endpoint.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
<a href="contracts/opl/Endpoint.sol//contracts/opl/Endpoint.sol/contract.BaseEndpoint.html">BaseEndpoint</a></p>
<p><strong>Title:</strong>
OPL Endpoint</p>
<p>An app that sends or receives using OPL.</p>
<h2 id="functions-5"><a class="header" href="#functions-5">Functions</a></h2>
<h3 id="constructor-3"><a class="header" href="#constructor-3">constructor</a></h3>
<pre><code class="language-solidity">constructor(address _remote, bytes32 _remoteChainName)
    BaseEndpoint(_remote, _getRemoteChainId(_remoteChainName), _getBus(_remote, _remoteChainName), false);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="_getbus"><a class="header" href="#_getbus">_getBus</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/opl/Endpoint.sol">Git Source</a></p>
<pre><code class="language-solidity">function _getBus(address _remote, bytes32 _remoteChainName) view returns (address);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="_getchainconfig"><a class="header" href="#_getchainconfig">_getChainConfig</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/opl/Endpoint.sol">Git Source</a></p>
<p>Configs from https://im-docs.celer.network/developer/contract-addresses-and-rpc-info.</p>
<pre><code class="language-solidity">function _getChainConfig(uint256 _chainId) pure returns (address _messageBus, bool _isTestnet);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="_chainname2chainid"><a class="header" href="#_chainname2chainid">_chainName2ChainId</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/opl/Endpoint.sol">Git Source</a></p>
<pre><code class="language-solidity">function _chainName2ChainId(bytes32 name) pure returns (uint256);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="_getremotechainid"><a class="header" href="#_getremotechainid">_getRemoteChainId</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/opl/Endpoint.sol">Git Source</a></p>
<pre><code class="language-solidity">function _getRemoteChainId(bytes32 _remoteChainName) view returns (uint256);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="autoswitch"><a class="header" href="#autoswitch">autoswitch</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/opl/Endpoint.sol">Git Source</a></p>
<p>Autoswitch automatically picks the remote network based on the
network the contract on which the contract has already been deployed. When on
testnet, the remote chain will be the testnet version of the provided chain.
When running locally, the remote chain will be this one and the contracts
will call each other without going through a message bus. This is helpful for
debugging logic but does not test gas fee payment and other moving parts.</p>
<pre><code class="language-solidity">function autoswitch(bytes32 protocol) view returns (bytes32 networkName);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="host"><a class="header" href="#host">Host</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/opl/Host.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
<a href="contracts/opl/Host.sol//contracts/opl/Endpoint.sol/contract.Endpoint.html">Endpoint</a></p>
<p><strong>Title:</strong>
OPL Host</p>
<p>The L1-side of an OPL dApp.</p>
<h2 id="functions-6"><a class="header" href="#functions-6">Functions</a></h2>
<h3 id="constructor-4"><a class="header" href="#constructor-4">constructor</a></h3>
<pre><code class="language-solidity">constructor(address _enclave) Endpoint(_enclave, autoswitch("sapphire"));
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="cbor_invalidkey"><a class="header" href="#cbor_invalidkey">CBOR_InvalidKey</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/CBOR.sol">Git Source</a></p>
<p>While parsing CBOR map, unexpected key</p>
<pre><code class="language-solidity">error CBOR_InvalidKey();
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="cbor_invalidmap"><a class="header" href="#cbor_invalidmap">CBOR_InvalidMap</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/CBOR.sol">Git Source</a></p>
<p>While parsing CBOR map, length is invalid, or other parse error</p>
<pre><code class="language-solidity">error CBOR_InvalidMap();
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="cbor_invalidlength"><a class="header" href="#cbor_invalidlength">CBOR_InvalidLength</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/CBOR.sol">Git Source</a></p>
<p>While parsing CBOR structure, data length was unexpected</p>
<pre><code class="language-solidity">error CBOR_InvalidLength(uint256);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="cbor_invaliduintprefix"><a class="header" href="#cbor_invaliduintprefix">CBOR_InvalidUintPrefix</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/CBOR.sol">Git Source</a></p>
<p>Value cannot be parsed as a uint</p>
<pre><code class="language-solidity">error CBOR_InvalidUintPrefix(uint8);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="cbor_invaliduintsize"><a class="header" href="#cbor_invaliduintsize">CBOR_InvalidUintSize</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/CBOR.sol">Git Source</a></p>
<p>CBOR spec supports, 1, 2, 4 &amp; 8 byte uints. Caused by parse error.</p>
<pre><code class="language-solidity">error CBOR_InvalidUintSize(uint8);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="cbor_error_valueoutofrange"><a class="header" href="#cbor_error_valueoutofrange">CBOR_Error_ValueOutOfRange</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/CBOR.sol">Git Source</a></p>
<p>CBOR parsed value is out of expected range</p>
<pre><code class="language-solidity">error CBOR_Error_ValueOutOfRange(uint256 value, uint256 maxValue);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="cbor_error_bufferoverrun"><a class="header" href="#cbor_error_bufferoverrun">CBOR_Error_BufferOverrun</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/CBOR.sol">Git Source</a></p>
<p>Buffer too short to parse expected value</p>
<pre><code class="language-solidity">error CBOR_Error_BufferOverrun(uint256 len, uint256 offset, uint256 need);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="cbor_error_bytestoolong"><a class="header" href="#cbor_error_bytestoolong">CBOR_Error_BytesTooLong</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/CBOR.sol">Git Source</a></p>
<p>Byte array is too long</p>
<p>Solidity has 256bit length prefixes for byte arrays. We decided for
a reasonable cutoff point (64kb), so at most a 2-byte uint describing
the array length.</p>
<pre><code class="language-solidity">error CBOR_Error_BytesTooLong(uint256 byteLength);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="parseuint128"><a class="header" href="#parseuint128">parseUint128</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/CBOR.sol">Git Source</a></p>
<pre><code class="language-solidity">function parseUint128(bytes memory result, uint256 offset) pure returns (uint256 newOffset, uint128 value);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="encodeuint"><a class="header" href="#encodeuint">encodeUint</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/CBOR.sol">Git Source</a></p>
<p>we don't follow bignum tagged encoding
See: https://www.rfc-editor.org/rfc/rfc8949.html#section-3.4.3</p>
<pre><code class="language-solidity">function encodeUint(uint256 value) pure returns (bytes memory);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="parseuint"><a class="header" href="#parseuint">parseUint</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/CBOR.sol">Git Source</a></p>
<pre><code class="language-solidity">function parseUint(bytes memory result, uint256 offset) pure returns (uint256 newOffset, uint256 value);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="encodebytes"><a class="header" href="#encodebytes">encodeBytes</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/CBOR.sol">Git Source</a></p>
<pre><code class="language-solidity">function encodeBytes(bytes memory in_bytes) pure returns (bytes memory out_cbor);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="parsekey"><a class="header" href="#parsekey">parseKey</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/CBOR.sol">Git Source</a></p>
<pre><code class="language-solidity">function parseKey(bytes memory result, uint256 offset) pure returns (uint256 newOffset, bytes32 keyDigest);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="parseuint64"><a class="header" href="#parseuint64">parseUint64</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/CBOR.sol">Git Source</a></p>
<pre><code class="language-solidity">function parseUint64(bytes memory result, uint256 offset) pure returns (uint256 newOffset, uint64 value);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="parsemapstart"><a class="header" href="#parsemapstart">parseMapStart</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/CBOR.sol">Git Source</a></p>
<pre><code class="language-solidity">function parseMapStart(bytes memory in_data, uint256 in_offset) pure returns (uint256 n_entries, uint256 out_offset);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="_derivekey"><a class="header" href="#_derivekey">_deriveKey</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/CalldataEncryption.sol">Git Source</a></p>
<pre><code class="language-solidity">function _deriveKey(bytes32 in_peerPublicKey, Sapphire.Curve25519SecretKey in_x25519_secret) view returns (bytes32);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="_encryptinner"><a class="header" href="#_encryptinner">_encryptInner</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/CalldataEncryption.sol">Git Source</a></p>
<pre><code class="language-solidity">function _encryptInner(
bytes memory in_data,
Sapphire.Curve25519SecretKey in_x25519_secret,
bytes15 nonce,
bytes32 peerPublicKey
) view returns (bytes memory out_encrypted);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="function-encryptcalldata"><a class="header" href="#function-encryptcalldata">function encryptCallData</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/CalldataEncryption.sol">Git Source</a></p>
<h3 id="encryptcalldatabytes"><a class="header" href="#encryptcalldatabytes">encryptCallData(bytes)</a></h3>
<pre><code class="language-solidity">function encryptCallData(bytes memory in_data) view returns (bytes memory out_encrypted);
</code></pre>
<h3 id="encryptcalldatabytes-sapphirecurve25519publickey-sapphirecurve25519secretkey-bytes15-uint256-bytes32"><a class="header" href="#encryptcalldatabytes-sapphirecurve25519publickey-sapphirecurve25519secretkey-bytes15-uint256-bytes32">encryptCallData(bytes, Sapphire.Curve25519PublicKey, Sapphire.Curve25519SecretKey, bytes15, uint256, bytes32)</a></h3>
<pre><code class="language-solidity">function encryptCallData(
bytes memory in_data,
Sapphire.Curve25519PublicKey myPublic,
Sapphire.Curve25519SecretKey mySecret,
bytes15 nonce,
uint256 epoch,
bytes32 peerPublicKey
) view returns (bytes memory out_encrypted);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="stakingaddress"><a class="header" href="#stakingaddress">StakingAddress</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/ConsensusUtils.sol">Git Source</a></p>
<p>21 byte version-prefixed address (1 byte version, 20 bytes truncated digest).</p>
<pre><code class="language-solidity">type StakingAddress is bytes21
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="stakingsecretkey"><a class="header" href="#stakingsecretkey">StakingSecretKey</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/ConsensusUtils.sol">Git Source</a></p>
<p>32 byte secret key.</p>
<pre><code class="language-solidity">type StakingSecretKey is bytes32
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="consensusutils"><a class="header" href="#consensusutils">ConsensusUtils</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/ConsensusUtils.sol">Git Source</a></p>
<p><strong>Title:</strong>
Consensus-level utilities</p>
<p>Generate Oasis wallets for use with staking at the consensus level.</p>
<h2 id="state-variables-3"><a class="header" href="#state-variables-3">State Variables</a></h2>
<h3 id="address_v0_context_identifier"><a class="header" href="#address_v0_context_identifier">ADDRESS_V0_CONTEXT_IDENTIFIER</a></h3>
<p>The unique context for v0 staking account addresses.</p>
<p><strong>Note:</strong>
see: @oasisprotocol/oasis-core :: go/staking/api/address.go</p>
<pre><code class="language-solidity">string private constant ADDRESS_V0_CONTEXT_IDENTIFIER = "oasis-core/address: staking"
</code></pre>
<h3 id="address_v0_context_version"><a class="header" href="#address_v0_context_version">ADDRESS_V0_CONTEXT_VERSION</a></h3>
<pre><code class="language-solidity">uint8 private constant ADDRESS_V0_CONTEXT_VERSION = 0
</code></pre>
<h2 id="functions-7"><a class="header" href="#functions-7">Functions</a></h2>
<h3 id="generatestakingaddress"><a class="header" href="#generatestakingaddress">generateStakingAddress</a></h3>
<p>Generate a random Ed25519 wallet for Oasis consensus-layer
staking.</p>
<pre><code class="language-solidity">function generateStakingAddress(bytes memory personalization)
    internal
    view
    returns (StakingAddress publicAddress, StakingSecretKey secretKey);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>personalization</code></td><td><code>bytes</code></td><td>Optional user-specified entropy.</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>publicAddress</code></td><td><code>StakingAddress</code></td><td>Public address of the keypair.</td></tr>
<tr><td><code>secretKey</code></td><td><code>StakingSecretKey</code></td><td>Secret key for the keypair.</td></tr>
</tbody></table>
</div>
<h3 id="_stakingaddressfrompublickey"><a class="header" href="#_stakingaddressfrompublickey">_stakingAddressFromPublicKey</a></h3>
<p>Derive the staking address from the public key.</p>
<pre><code class="language-solidity">function _stakingAddressFromPublicKey(bytes32 ed25519publicKey) internal view returns (bytes21);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>ed25519publicKey</code></td><td><code>bytes32</code></td><td>Ed25519 public key.</td></tr>
</tbody></table>
</div>
<h3 id="_addressfromdata"><a class="header" href="#_addressfromdata">_addressFromData</a></h3>
<p>Derive an Oasis-style address.</p>
<pre><code class="language-solidity">function _addressFromData(string memory contextIdentifier, uint8 contextVersion, bytes memory data)
    internal
    view
    returns (bytes21);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>contextIdentifier</code></td><td><code>string</code></td><td>Domain separator.</td></tr>
<tr><td><code>contextVersion</code></td><td><code>uint8</code></td><td>Domain version.</td></tr>
<tr><td><code>data</code></td><td><code>bytes</code></td><td>Public point of the keypair.</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="datetime"><a class="header" href="#datetime">DateTime</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/DateTime.sol">Git Source</a></p>
<p><strong>Title:</strong>
Utility for converting date and time to timestamp</p>
<p>Considers leap year, but not leap second.</p>
<p><strong>Note:</strong>
attribution: https://github.com/pipermerriam/ethereum-datetime/blob/master/contracts/contracts/DateTime.sol</p>
<h2 id="state-variables-4"><a class="header" href="#state-variables-4">State Variables</a></h2>
<h3 id="origin_year"><a class="header" href="#origin_year">ORIGIN_YEAR</a></h3>
<pre><code class="language-solidity">uint16 private constant ORIGIN_YEAR = 1970
</code></pre>
<h2 id="functions-8"><a class="header" href="#functions-8">Functions</a></h2>
<h3 id="isleapyear"><a class="header" href="#isleapyear">isLeapYear</a></h3>
<pre><code class="language-solidity">function isLeapYear(uint16 year) internal pure returns (bool);
</code></pre>
<h3 id="totimestamp"><a class="header" href="#totimestamp">toTimestamp</a></h3>
<p>Convert year, month, day, hour, minute, second to Unix timestamp.</p>
<p>Leap second is not supported.</p>
<pre><code class="language-solidity">function toTimestamp(uint16 year, uint8 month, uint8 day, uint8 hour, uint8 minute, uint8 second)
    internal
    pure
    returns (uint256 timestamp);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="eip1559signer"><a class="header" href="#eip1559signer">EIP1559Signer</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/EIP1559Signer.sol">Git Source</a></p>
<p><strong>Title:</strong>
Ethereum EIP-1559 transaction signer &amp; encoder</p>
<h2 id="functions-9"><a class="header" href="#functions-9">Functions</a></h2>
<h3 id="encodeunsignedtx"><a class="header" href="#encodeunsignedtx">encodeUnsignedTx</a></h3>
<p>Encode an unsigned EIP-1559 transaction for signing</p>
<pre><code class="language-solidity">function encodeUnsignedTx(EIP1559Tx memory rawTx) internal pure returns (bytes memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>rawTx</code></td><td><code>EIP1559Tx</code></td><td>Transaction to encode</td></tr>
</tbody></table>
</div>
<h3 id="encodesignedtx"><a class="header" href="#encodesignedtx">encodeSignedTx</a></h3>
<p>Encode a signed EIP-1559 transaction</p>
<pre><code class="language-solidity">function encodeSignedTx(EIP1559Tx memory rawTx, SignatureRSV memory rsv) internal pure returns (bytes memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>rawTx</code></td><td><code>EIP1559Tx</code></td><td>Transaction which was signed</td></tr>
<tr><td><code>rsv</code></td><td><code>SignatureRSV</code></td><td>R, S &amp; V parameters of signature</td></tr>
</tbody></table>
</div>
<h3 id="signrawtx"><a class="header" href="#signrawtx">signRawTx</a></h3>
<p>Sign a raw transaction</p>
<pre><code class="language-solidity">function signRawTx(EIP1559Tx memory rawTx, address pubkeyAddr, bytes32 secretKey)
    internal
    view
    returns (SignatureRSV memory ret);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>rawTx</code></td><td><code>EIP1559Tx</code></td><td>Transaction to sign</td></tr>
<tr><td><code>pubkeyAddr</code></td><td><code>address</code></td><td>Ethereum address of secret key</td></tr>
<tr><td><code>secretKey</code></td><td><code>bytes32</code></td><td>Secret key used to sign</td></tr>
</tbody></table>
</div>
<h3 id="sign"><a class="header" href="#sign">sign</a></h3>
<p>Sign a transaction, returning it in EIP-1559 encoded form</p>
<pre><code class="language-solidity">function sign(address publicAddress, bytes32 secretKey, EIP1559Tx memory transaction)
    internal
    view
    returns (bytes memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>publicAddress</code></td><td><code>address</code></td><td>Ethereum address of secret key</td></tr>
<tr><td><code>secretKey</code></td><td><code>bytes32</code></td><td>Secret key used to sign</td></tr>
<tr><td><code>transaction</code></td><td><code>EIP1559Tx</code></td><td>Transaction to sign</td></tr>
</tbody></table>
</div>
<h2 id="structs"><a class="header" href="#structs">Structs</a></h2>
<h3 id="eip1559tx"><a class="header" href="#eip1559tx">EIP1559Tx</a></h3>
<pre><code class="language-solidity">struct EIP1559Tx {
    uint64 nonce;
    uint256 maxPriorityFeePerGas;
    uint256 maxFeePerGas;
    uint64 gasLimit;
    address to;
    uint256 value;
    bytes data;
    EIPTypes.AccessList accessList;
    uint256 chainId;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="eip155signer"><a class="header" href="#eip155signer">EIP155Signer</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/EIP155Signer.sol">Git Source</a></p>
<p><strong>Title:</strong>
Ethereum EIP-155 compatible transaction signer &amp; encoder</p>
<h2 id="functions-10"><a class="header" href="#functions-10">Functions</a></h2>
<h3 id="encodesignedtx-1"><a class="header" href="#encodesignedtx-1">encodeSignedTx</a></h3>
<p>Encode a signed EIP-155 transaction.</p>
<pre><code class="language-solidity">function encodeSignedTx(EthTx memory rawTx, SignatureRSV memory rsv) internal pure returns (bytes memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>rawTx</code></td><td><code>EthTx</code></td><td>Transaction which was signed.</td></tr>
<tr><td><code>rsv</code></td><td><code>SignatureRSV</code></td><td>R, S &amp; V parameters of signature.</td></tr>
</tbody></table>
</div>
<h3 id="signrawtx-1"><a class="header" href="#signrawtx-1">signRawTx</a></h3>
<p>Sign a raw transaction, which will then need to be encoded to
include the signature.</p>
<pre><code class="language-solidity">function signRawTx(EthTx memory rawTx, address pubkeyAddr, bytes32 secretKey)
    internal
    view
    returns (SignatureRSV memory ret);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>rawTx</code></td><td><code>EthTx</code></td><td>Transaction to sign.</td></tr>
<tr><td><code>pubkeyAddr</code></td><td><code>address</code></td><td>Ethereum address of secret key.</td></tr>
<tr><td><code>secretKey</code></td><td><code>bytes32</code></td><td>Secret key used to sign.</td></tr>
</tbody></table>
</div>
<h3 id="sign-1"><a class="header" href="#sign-1">sign</a></h3>
<p>Sign a transaction, returning it in EIP-155 encoded form.</p>
<pre><code class="language-solidity">function sign(address publicAddress, bytes32 secretKey, EthTx memory transaction)
    internal
    view
    returns (bytes memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>publicAddress</code></td><td><code>address</code></td><td>Ethereum address of secret key.</td></tr>
<tr><td><code>secretKey</code></td><td><code>bytes32</code></td><td>Secret key used to sign.</td></tr>
<tr><td><code>transaction</code></td><td><code>EthTx</code></td><td>Transaction to sign.</td></tr>
</tbody></table>
</div>
<h2 id="structs-1"><a class="header" href="#structs-1">Structs</a></h2>
<h3 id="ethtx"><a class="header" href="#ethtx">EthTx</a></h3>
<pre><code class="language-solidity">struct EthTx {
    uint64 nonce;
    uint256 gasPrice;
    uint64 gasLimit;
    address to;
    uint256 value;
    bytes data;
    uint256 chainId;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="eip2930signer"><a class="header" href="#eip2930signer">EIP2930Signer</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/EIP2930Signer.sol">Git Source</a></p>
<p><strong>Title:</strong>
Ethereum EIP-2930 transaction signer &amp; encoder</p>
<h2 id="functions-11"><a class="header" href="#functions-11">Functions</a></h2>
<h3 id="encodeunsignedtx-1"><a class="header" href="#encodeunsignedtx-1">encodeUnsignedTx</a></h3>
<p>Encode an unsigned EIP-2930 transaction for signing</p>
<pre><code class="language-solidity">function encodeUnsignedTx(EIP2930Tx memory rawTx) internal pure returns (bytes memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>rawTx</code></td><td><code>EIP2930Tx</code></td><td>Transaction to encode</td></tr>
</tbody></table>
</div>
<h3 id="encodesignedtx-2"><a class="header" href="#encodesignedtx-2">encodeSignedTx</a></h3>
<p>Encode a signed EIP-2930 transaction</p>
<pre><code class="language-solidity">function encodeSignedTx(EIP2930Tx memory rawTx, SignatureRSV memory rsv) internal pure returns (bytes memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>rawTx</code></td><td><code>EIP2930Tx</code></td><td>Transaction which was signed</td></tr>
<tr><td><code>rsv</code></td><td><code>SignatureRSV</code></td><td>R, S &amp; V parameters of signature</td></tr>
</tbody></table>
</div>
<h3 id="signrawtx-2"><a class="header" href="#signrawtx-2">signRawTx</a></h3>
<p>Sign a raw transaction</p>
<pre><code class="language-solidity">function signRawTx(EIP2930Tx memory rawTx, address pubkeyAddr, bytes32 secretKey)
    internal
    view
    returns (SignatureRSV memory ret);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>rawTx</code></td><td><code>EIP2930Tx</code></td><td>Transaction to sign</td></tr>
<tr><td><code>pubkeyAddr</code></td><td><code>address</code></td><td>Ethereum address of secret key</td></tr>
<tr><td><code>secretKey</code></td><td><code>bytes32</code></td><td>Secret key used to sign</td></tr>
</tbody></table>
</div>
<h3 id="sign-2"><a class="header" href="#sign-2">sign</a></h3>
<p>Sign a transaction, returning it in EIP-2930 encoded form</p>
<pre><code class="language-solidity">function sign(address publicAddress, bytes32 secretKey, EIP2930Tx memory transaction)
    internal
    view
    returns (bytes memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>publicAddress</code></td><td><code>address</code></td><td>Ethereum address of secret key</td></tr>
<tr><td><code>secretKey</code></td><td><code>bytes32</code></td><td>Secret key used to sign</td></tr>
<tr><td><code>transaction</code></td><td><code>EIP2930Tx</code></td><td>Transaction to sign</td></tr>
</tbody></table>
</div>
<h2 id="structs-2"><a class="header" href="#structs-2">Structs</a></h2>
<h3 id="eip2930tx"><a class="header" href="#eip2930tx">EIP2930Tx</a></h3>
<pre><code class="language-solidity">struct EIP2930Tx {
    uint64 nonce;
    uint256 gasPrice;
    uint64 gasLimit;
    address to;
    uint256 value;
    bytes data;
    EIPTypes.AccessList accessList;
    uint256 chainId;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="eiptypes"><a class="header" href="#eiptypes">EIPTypes</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/EIPTypes.sol">Git Source</a></p>
<h2 id="functions-12"><a class="header" href="#functions-12">Functions</a></h2>
<h3 id="encodeaccesslist"><a class="header" href="#encodeaccesslist">encodeAccessList</a></h3>
<p>Encode an access list for EIP-1559 and EIP-2930 transactions</p>
<pre><code class="language-solidity">function encodeAccessList(AccessList memory list) internal pure returns (bytes memory);
</code></pre>
<h2 id="structs-3"><a class="header" href="#structs-3">Structs</a></h2>
<h3 id="accesslist"><a class="header" href="#accesslist">AccessList</a></h3>
<pre><code class="language-solidity">struct AccessList {
    AccessListItem[] items;
}
</code></pre>
<h3 id="accesslistitem"><a class="header" href="#accesslistitem">AccessListItem</a></h3>
<pre><code class="language-solidity">struct AccessListItem {
    address addr;
    bytes32[] storageKeys;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="signaturersv"><a class="header" href="#signaturersv">SignatureRSV</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/EthereumUtils.sol">Git Source</a></p>
<pre><code class="language-solidity">struct SignatureRSV {
bytes32 r;
bytes32 s;
uint256 v;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ethereumutils"><a class="header" href="#ethereumutils">EthereumUtils</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/EthereumUtils.sol">Git Source</a></p>
<h2 id="state-variables-5"><a class="header" href="#state-variables-5">State Variables</a></h2>
<h3 id="k256_p"><a class="header" href="#k256_p">K256_P</a></h3>
<pre><code class="language-solidity">uint256 internal constant K256_P = 0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f
</code></pre>
<h3 id="k256_p_plus_1_over_4"><a class="header" href="#k256_p_plus_1_over_4">K256_P_PLUS_1_OVER_4</a></h3>
<pre><code class="language-solidity">uint256 internal constant K256_P_PLUS_1_OVER_4 = 0x3fffffffffffffffffffffffffffffffffffffffffffffffffffffffbfffff0c
</code></pre>
<h3 id="precompile_bigmodexp"><a class="header" href="#precompile_bigmodexp">PRECOMPILE_BIGMODEXP</a></h3>
<pre><code class="language-solidity">address internal constant PRECOMPILE_BIGMODEXP = address(0x5)
</code></pre>
<h2 id="functions-13"><a class="header" href="#functions-13">Functions</a></h2>
<h3 id="expmod"><a class="header" href="#expmod">expmod</a></h3>
<pre><code class="language-solidity">function expmod(uint256 base, uint256 exponent, uint256 modulus) internal view returns (uint256 out);
</code></pre>
<h3 id="k256derivey"><a class="header" href="#k256derivey">k256DeriveY</a></h3>
<p>Recover Y coordinate from X coordinate and sign bit.</p>
<pre><code class="language-solidity">function k256DeriveY(uint8 prefix, uint256 x) internal view returns (uint256 y);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>prefix</code></td><td><code>uint8</code></td><td>0x02 or 0x03 indicates sign bit of compressed point.</td></tr>
<tr><td><code>x</code></td><td><code>uint256</code></td><td>X coordinate.</td></tr>
</tbody></table>
</div>
<h3 id="k256decompress"><a class="header" href="#k256decompress">k256Decompress</a></h3>
<p>Decompress SEC P256 k1 point.</p>
<pre><code class="language-solidity">function k256Decompress(bytes memory pk) internal view returns (uint256 x, uint256 y);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>pk</code></td><td><code>bytes</code></td><td>33 byte compressed public key.</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>x</code></td><td><code>uint256</code></td><td>X coordinate.</td></tr>
<tr><td><code>y</code></td><td><code>uint256</code></td><td>Y coordinate.</td></tr>
</tbody></table>
</div>
<h3 id="k256pubkeytoethereumaddress"><a class="header" href="#k256pubkeytoethereumaddress">k256PubkeyToEthereumAddress</a></h3>
<pre><code class="language-solidity">function k256PubkeyToEthereumAddress(bytes memory pubkey) internal view returns (address);
</code></pre>
<h3 id="toethereumaddress"><a class="header" href="#toethereumaddress">toEthereumAddress</a></h3>
<p>Convert SEC P256 k1 curve point to Ethereum address.</p>
<p><strong>Note:</strong>
see: https://gavwood.com/paper.pdf (pp. 212)</p>
<pre><code class="language-solidity">function toEthereumAddress(uint256 x, uint256 y) internal pure returns (address);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>x</code></td><td><code>uint256</code></td><td>X coordinate.</td></tr>
<tr><td><code>y</code></td><td><code>uint256</code></td><td>Y coordinate.</td></tr>
</tbody></table>
</div>
<h3 id="splitdersignature"><a class="header" href="#splitdersignature">splitDERSignature</a></h3>
<p>Extracts the <code>r</code> and <code>s</code> parameters from a DER encoded ECDSA
signature.
The signature is an ASN1 encoded SEQUENCE of the variable length <code>r</code> and
<code>s</code> INTEGERs.</p>
<pre><code>| 0x30 | len(z) | 0x02 | len(r) |  r   | 0x02 | len(s) |  s   | = hex value
|  1   |   1    |   1  |   1    | 1-33 |  1   |   1    | 1-33 | = byte length
</code></pre>
<p>If the highest bit of either <code>r</code> or <code>s</code> is set, it will be prefix padded
with a zero byte. There is exponentially decreasing probability that
either <code>r</code> or <code>s</code> will be below 32 bytes. There is a very high
probability that either <code>r</code> or <code>s</code> will be 33 bytes. This function only
works if either <code>r</code> or <code>s</code> are 256bits or lower.</p>
<p><strong>Note:</strong>
see: https://bitcoin.stackexchange.com/questions/58853/how-do-you-figure-out-the-r-and-s-out-of-a-signature-using-python</p>
<pre><code class="language-solidity">function splitDERSignature(bytes memory der) internal pure returns (SignatureRSV memory rsv);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>der</code></td><td><code>bytes</code></td><td>DER encoded ECDSA signature</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>rsv</code></td><td><code>SignatureRSV</code></td><td>ECDSA R point X coordinate, and S scalar</td></tr>
</tbody></table>
</div>
<h3 id="recoverv"><a class="header" href="#recoverv">recoverV</a></h3>
<pre><code class="language-solidity">function recoverV(address pubkeyAddr, bytes32 digest, SignatureRSV memory rsv) internal pure;
</code></pre>
<h3 id="toethereumsignature"><a class="header" href="#toethereumsignature">toEthereumSignature</a></h3>
<p>Convert a Secp256k1PrehashedKeccak256 signature to one accepted
by ecrecover.</p>
<p><strong>Note:</strong>
see: https://gavwood.com/paper.pdf (pp. 206)</p>
<pre><code class="language-solidity">function toEthereumSignature(bytes memory pubkey, bytes32 digest, bytes memory signature)
    internal
    view
    returns (address pubkeyAddr, SignatureRSV memory rsv);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>pubkey</code></td><td><code>bytes</code></td><td>33 byte compressed public key.</td></tr>
<tr><td><code>digest</code></td><td><code>bytes32</code></td><td>32 byte pre-hashed message digest.</td></tr>
<tr><td><code>signature</code></td><td><code>bytes</code></td><td>ASN.1 DER encoded signature, as returned from <a href="contracts/EthereumUtils.sol/../Sapphire.sol/library.Sapphire.html#sign"><code>Sapphire.sign</code></a>.</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>pubkeyAddr</code></td><td><code>address</code></td><td>20 byte Ethereum address.</td></tr>
<tr><td><code>rsv</code></td><td><code>SignatureRSV</code></td><td>Ethereum EcDSA RSV signature values.</td></tr>
</tbody></table>
</div>
<h3 id="sign-3"><a class="header" href="#sign-3">sign</a></h3>
<pre><code class="language-solidity">function sign(address pubkeyAddr, bytes32 secretKey, bytes32 digest)
    internal
    view
    returns (SignatureRSV memory rsv);
</code></pre>
<h3 id="generatekeypair"><a class="header" href="#generatekeypair">generateKeypair</a></h3>
<p>Generate an Ethereum compatible SEC P256 k1 keypair and
corresponding public address.</p>
<pre><code class="language-solidity">function generateKeypair() internal view returns (address pubkeyAddr, bytes32 secretKey);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>pubkeyAddr</code></td><td><code>address</code></td><td>Ethereum address.</td></tr>
<tr><td><code>secretKey</code></td><td><code>bytes32</code></td><td>Secret key used for signing.</td></tr>
</tbody></table>
</div>
<h2 id="errors-2"><a class="header" href="#errors-2">Errors</a></h2>
<h3 id="expmod_error"><a class="header" href="#expmod_error">expmod_Error</a></h3>
<pre><code class="language-solidity">error expmod_Error();
</code></pre>
<h3 id="k256derivey_invalid_prefix_error"><a class="header" href="#k256derivey_invalid_prefix_error">k256DeriveY_Invalid_Prefix_Error</a></h3>
<pre><code class="language-solidity">error k256DeriveY_Invalid_Prefix_Error();
</code></pre>
<h3 id="k256decompress_invalid_length_error"><a class="header" href="#k256decompress_invalid_length_error">k256Decompress_Invalid_Length_Error</a></h3>
<pre><code class="language-solidity">error k256Decompress_Invalid_Length_Error();
</code></pre>
<h3 id="der_split_error"><a class="header" href="#der_split_error">DER_Split_Error</a></h3>
<pre><code class="language-solidity">error DER_Split_Error();
</code></pre>
<h3 id="recoverv_error"><a class="header" href="#recoverv_error">recoverV_Error</a></h3>
<pre><code class="language-solidity">error recoverV_Error();
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="rlpwriter"><a class="header" href="#rlpwriter">RLPWriter</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/RLPWriter.sol">Git Source</a></p>
<p><strong>Title:</strong>
RLPWriter</p>
<p><strong>Author:</strong>
RLPWriter is a library for encoding Solidity types to RLP bytes. Adapted from Bakaoh's
RLPEncode library (https://github.com/bakaoh/solidity-rlp-encode) with minor
modifications to improve legibility.</p>
<p><strong>Notes:</strong></p>
<ul>
<li>
<p>attribution: https://github.com/bakaoh/solidity-rlp-encode</p>
</li>
<li>
<p>attribution: https://raw.githubusercontent.com/Maia-DAO/solidity-rlp-encoder/main/rlp/RLPWriter.sol</p>
</li>
</ul>
<h2 id="functions-14"><a class="header" href="#functions-14">Functions</a></h2>
<h3 id="writebytes"><a class="header" href="#writebytes">writeBytes</a></h3>
<p>RLP encodes a byte string.</p>
<pre><code class="language-solidity">function writeBytes(bytes memory _in) internal pure returns (bytes memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_in</code></td><td><code>bytes</code></td><td>The byte string to encode.</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes</code></td><td>The RLP encoded string in bytes.</td></tr>
</tbody></table>
</div>
<h3 id="writelist"><a class="header" href="#writelist">writeList</a></h3>
<p>RLP encodes a list of RLP encoded byte byte strings.</p>
<pre><code class="language-solidity">function writeList(bytes memory _in) internal pure returns (bytes memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_in</code></td><td><code>bytes</code></td><td>The RLP encoded byte strings.</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes</code></td><td>The RLP encoded list of items in bytes.</td></tr>
</tbody></table>
</div>
<h3 id="writelist-1"><a class="header" href="#writelist-1">writeList</a></h3>
<p>RLP encodes a list of RLP encoded byte byte strings.</p>
<pre><code class="language-solidity">function writeList(bytes[] memory _in) internal pure returns (bytes memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_in</code></td><td><code>bytes[]</code></td><td>The list of RLP encoded byte strings.</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes</code></td><td>The RLP encoded list of items in bytes.</td></tr>
</tbody></table>
</div>
<h3 id="writestring"><a class="header" href="#writestring">writeString</a></h3>
<p>RLP encodes a string.</p>
<pre><code class="language-solidity">function writeString(string memory _in) internal pure returns (bytes memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_in</code></td><td><code>string</code></td><td>The string to encode.</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes</code></td><td>The RLP encoded string in bytes.</td></tr>
</tbody></table>
</div>
<h3 id="writeaddress"><a class="header" href="#writeaddress">writeAddress</a></h3>
<p>RLP encodes an address.</p>
<pre><code class="language-solidity">function writeAddress(address _in) internal pure returns (bytes memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_in</code></td><td><code>address</code></td><td>The address to encode.</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes</code></td><td>The RLP encoded address in bytes.</td></tr>
</tbody></table>
</div>
<h3 id="writeuint"><a class="header" href="#writeuint">writeUint</a></h3>
<p>RLP encodes a uint.</p>
<pre><code class="language-solidity">function writeUint(uint256 _in) internal pure returns (bytes memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_in</code></td><td><code>uint256</code></td><td>The uint256 to encode.</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes</code></td><td>The RLP encoded uint256 in bytes.</td></tr>
</tbody></table>
</div>
<h3 id="writebool"><a class="header" href="#writebool">writeBool</a></h3>
<p>RLP encodes a bool.</p>
<pre><code class="language-solidity">function writeBool(bool _in) internal pure returns (bytes memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_in</code></td><td><code>bool</code></td><td>The bool to encode.</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes</code></td><td>The RLP encoded bool in bytes.</td></tr>
</tbody></table>
</div>
<h3 id="_writelength"><a class="header" href="#_writelength">_writeLength</a></h3>
<p>Encode the first byte and then the <code>len</code> in binary form if
<code>length</code> is more than 55.</p>
<pre><code class="language-solidity">function _writeLength(uint256 _len, uint256 _offset) private pure returns (bytes memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_len</code></td><td><code>uint256</code></td><td>The length of the string or the payload.</td></tr>
<tr><td><code>_offset</code></td><td><code>uint256</code></td><td>128 if item is string, 192 if item is list.</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes</code></td><td>RLP encoded bytes.</td></tr>
</tbody></table>
</div>
<h3 id="_tobinary"><a class="header" href="#_tobinary">_toBinary</a></h3>
<p>Encode integer in big endian binary form with no leading zeroes.</p>
<pre><code class="language-solidity">function _toBinary(uint256 _x) private pure returns (bytes memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_x</code></td><td><code>uint256</code></td><td>The integer to encode.</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes</code></td><td>RLP encoded bytes.</td></tr>
</tbody></table>
</div>
<h3 id="_memcpy"><a class="header" href="#_memcpy">_memcpy</a></h3>
<p>Copies a piece of memory to another location.</p>
<p><strong>Note:</strong>
attribution: https://github.com/Arachnid/solidity-stringutils</p>
<pre><code class="language-solidity">function _memcpy(uint256 _dest, uint256 _src, uint256 _len) private pure;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_dest</code></td><td><code>uint256</code></td><td>Destination location.</td></tr>
<tr><td><code>_src</code></td><td><code>uint256</code></td><td>Source location.</td></tr>
<tr><td><code>_len</code></td><td><code>uint256</code></td><td>Length of memory to copy.</td></tr>
</tbody></table>
</div>
<h3 id="_flatten"><a class="header" href="#_flatten">_flatten</a></h3>
<p>Flattens a list of byte strings into one byte string.</p>
<p><strong>Note:</strong>
attribution: https://github.com/sammayo/solidity-rlp-encoder</p>
<pre><code class="language-solidity">function _flatten(bytes[] memory _list) private pure returns (bytes memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_list</code></td><td><code>bytes[]</code></td><td>List of byte strings to flatten.</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes</code></td><td>The flattened byte string.</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="sapphire"><a class="header" href="#sapphire">Sapphire</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/Sapphire.sol">Git Source</a></p>
<p><strong>Title:</strong>
Sapphire</p>
<p>This library provides a number of convenient wrappers for
cryptographic operations such as the x25519 key derivation, Deoxys-II-based
encryption and decryption, signing key generation, message digest signing and
verification, gas padding and hashing.
Most of the mentioned functions are implemented as Sapphire's precompiles and
are cheap to call.</p>
<h4 id="calling-precompiles-manually"><a class="header" href="#calling-precompiles-manually">Calling Precompiles Manually</a></h4>
<p>You can override the wrappers and call Sapphire precompiles by dispatching
calls to specific well-known contract addresses, as described below. The
<strong>Precompile address</strong> section of each function will show you the address
of the corresponding precompile.
Input parameters should be packed into a contiguous memory region with each
chunk of data padded to 32 bytes as usual. The recommended way to construct
parameter byte sequences in Solidity is with <code>abi.encode</code> and <code>abi.decode</code>,
which will transparently handle things like putting <code>bytes</code> lengths in the
correct position.</p>
<h2 id="state-variables-6"><a class="header" href="#state-variables-6">State Variables</a></h2>
<h3 id="random_bytes"><a class="header" href="#random_bytes">RANDOM_BYTES</a></h3>
<pre><code class="language-solidity">address internal constant RANDOM_BYTES = 0x0100000000000000000000000000000000000001
</code></pre>
<h3 id="derive_key"><a class="header" href="#derive_key">DERIVE_KEY</a></h3>
<pre><code class="language-solidity">address internal constant DERIVE_KEY = 0x0100000000000000000000000000000000000002
</code></pre>
<h3 id="encrypt"><a class="header" href="#encrypt">ENCRYPT</a></h3>
<pre><code class="language-solidity">address internal constant ENCRYPT = 0x0100000000000000000000000000000000000003
</code></pre>
<h3 id="decrypt"><a class="header" href="#decrypt">DECRYPT</a></h3>
<pre><code class="language-solidity">address internal constant DECRYPT = 0x0100000000000000000000000000000000000004
</code></pre>
<h3 id="generate_signing_keypair"><a class="header" href="#generate_signing_keypair">GENERATE_SIGNING_KEYPAIR</a></h3>
<pre><code class="language-solidity">address internal constant GENERATE_SIGNING_KEYPAIR = 0x0100000000000000000000000000000000000005
</code></pre>
<h3 id="sign_digest"><a class="header" href="#sign_digest">SIGN_DIGEST</a></h3>
<pre><code class="language-solidity">address internal constant SIGN_DIGEST = 0x0100000000000000000000000000000000000006
</code></pre>
<h3 id="verify_digest"><a class="header" href="#verify_digest">VERIFY_DIGEST</a></h3>
<pre><code class="language-solidity">address internal constant VERIFY_DIGEST = 0x0100000000000000000000000000000000000007
</code></pre>
<h3 id="curve25519_public_key"><a class="header" href="#curve25519_public_key">CURVE25519_PUBLIC_KEY</a></h3>
<pre><code class="language-solidity">address internal constant CURVE25519_PUBLIC_KEY = 0x0100000000000000000000000000000000000008
</code></pre>
<h3 id="gas_used"><a class="header" href="#gas_used">GAS_USED</a></h3>
<pre><code class="language-solidity">address internal constant GAS_USED = 0x0100000000000000000000000000000000000009
</code></pre>
<h3 id="pad_gas"><a class="header" href="#pad_gas">PAD_GAS</a></h3>
<pre><code class="language-solidity">address internal constant PAD_GAS = 0x010000000000000000000000000000000000000a
</code></pre>
<h3 id="sha512_256"><a class="header" href="#sha512_256">SHA512_256</a></h3>
<pre><code class="language-solidity">address internal constant SHA512_256 = 0x0100000000000000000000000000000000000101
</code></pre>
<h3 id="sha512"><a class="header" href="#sha512">SHA512</a></h3>
<pre><code class="language-solidity">address internal constant SHA512 = 0x0100000000000000000000000000000000000102
</code></pre>
<h3 id="sha384"><a class="header" href="#sha384">SHA384</a></h3>
<pre><code class="language-solidity">address internal constant SHA384 = 0x0100000000000000000000000000000000000104
</code></pre>
<h2 id="functions-15"><a class="header" href="#functions-15">Functions</a></h2>
<h3 id="randombytes"><a class="header" href="#randombytes">randomBytes</a></h3>
<p>Generate <code>num_bytes</code> pseudo-random bytes, with an optional
personalization string (<code>pers</code>) added into the hashing algorithm to
increase domain separation when needed.</p>
<h4 id="precompile-address"><a class="header" href="#precompile-address">Precompile address</a></h4>
<p><code>0x0100000000000000000000000000000000000001</code></p>
<h4 id="gas-cost"><a class="header" href="#gas-cost">Gas cost</a></h4>
<p>10,000 minimum plus 240 per output word plus 60 per word of the
personalization string.</p>
<h4 id="implementation-details"><a class="header" href="#implementation-details">Implementation details</a></h4>
<p>The mode (e.g. simulation or "view call" vs transaction execution) is fed
to TupleHash (among other block-dependent components) to derive the "key
id", which is then used to derive a per-block VRF key from
epoch-ephemeral entropy (using KMAC256 and cSHAKE) so a different key
id will result in a unique per-block VRF key. This per-block VRF key is
then used to create the per-block root RNG which is then used to derive
domain-separated (using Merlin transcripts) per-transaction random RNGs
which are then exposed via this precompile. The KMAC, cSHAKE and
TupleHash algorithms are SHA-3 derived functions defined in <a href="https://nvlpubs.nist.gov/nistpubs/specialpublications/nist.sp.800-185.pdf">NIST
Special Publication 800-185</a>.</p>
<h4 id="example-1"><a class="header" href="#example-1">Example</a></h4>
<pre><code class="language-solidity">bytes memory randomPad = Sapphire.randomBytes(64, "");
</code></pre>
<pre><code class="language-solidity">function randomBytes(uint256 numBytes, bytes memory pers) internal view returns (bytes memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>numBytes</code></td><td><code>uint256</code></td><td>The number of bytes to return.</td></tr>
<tr><td><code>pers</code></td><td><code>bytes</code></td><td>An optional personalization string to increase domain separation.</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes</code></td><td>The random bytes. If the number of bytes requested is too large (over 1024), a smaller amount (1024) will be returned.</td></tr>
</tbody></table>
</div>
<h3 id="generatecurve25519keypair"><a class="header" href="#generatecurve25519keypair">generateCurve25519KeyPair</a></h3>
<p>Generates a Curve25519 keypair.</p>
<pre><code class="language-solidity">function generateCurve25519KeyPair(bytes memory pers)
    internal
    view
    returns (Curve25519PublicKey pk, Curve25519SecretKey sk);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>pers</code></td><td><code>bytes</code></td><td>An optional personalization string used to add domain separation.</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>pk</code></td><td><code>Curve25519PublicKey</code></td><td>The Curve25519 public key. Useful for key exchange.</td></tr>
<tr><td><code>sk</code></td><td><code>Curve25519SecretKey</code></td><td>The Curve25519 secret key. Pairs well with <a href="contracts/Sapphire.sol/library.Sapphire.html#derivesymmetrickey">deriveSymmetricKey</a>.</td></tr>
</tbody></table>
</div>
<h3 id="derivesymmetrickey"><a class="header" href="#derivesymmetrickey">deriveSymmetricKey</a></h3>
<p>Derive a symmetric key from a pair of keys using x25519.</p>
<h4 id="precompile-address-1"><a class="header" href="#precompile-address-1">Precompile address</a></h4>
<p><code>0x0100000000000000000000000000000000000002</code></p>
<h4 id="gas-cost-1"><a class="header" href="#gas-cost-1">Gas cost</a></h4>
<p>100,000</p>
<h4 id="example-2"><a class="header" href="#example-2">Example</a></h4>
<pre><code class="language-solidity">bytes32 publicKey = ... ;
bytes32 privateKey = ... ;
bytes32 symmetric = Sapphire.deriveSymmetricKey(publicKey, privateKey);
</code></pre>
<pre><code class="language-solidity">function deriveSymmetricKey(Curve25519PublicKey peerPublicKey, Curve25519SecretKey secretKey)
    internal
    view
    returns (bytes32);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>peerPublicKey</code></td><td><code>Curve25519PublicKey</code></td><td>The peer's public key.</td></tr>
<tr><td><code>secretKey</code></td><td><code>Curve25519SecretKey</code></td><td>Your secret key.</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes32</code></td><td>A derived symmetric key.</td></tr>
</tbody></table>
</div>
<h3 id="encrypt-1"><a class="header" href="#encrypt-1">encrypt</a></h3>
<p>Encrypt and authenticate the plaintext and additional data using
DeoxysII.</p>
<h4 id="precompile-address-2"><a class="header" href="#precompile-address-2">Precompile address</a></h4>
<p><code>0x0100000000000000000000000000000000000003</code></p>
<h4 id="gas-cost-2"><a class="header" href="#gas-cost-2">Gas cost</a></h4>
<p>50,000 minimum plus 100 per word of input</p>
<h4 id="example-3"><a class="header" href="#example-3">Example</a></h4>
<pre><code class="language-solidity">bytes32 key = ... ;
bytes32 nonce = ... ;
bytes memory text = "plain text";
bytes memory ad = "additional data";
bytes memory encrypted = Sapphire.encrypt(key, nonce, text, ad);
bytes memory decrypted = Sapphire.decrypt(key, nonce, encrypted, ad);
</code></pre>
<pre><code class="language-solidity">function encrypt(bytes32 key, bytes32 nonce, bytes memory plaintext, bytes memory additionalData)
    internal
    view
    returns (bytes memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>key</code></td><td><code>bytes32</code></td><td>The key to use for encryption.</td></tr>
<tr><td><code>nonce</code></td><td><code>bytes32</code></td><td>The nonce. Note that only the first 15 bytes of this parameter are used.</td></tr>
<tr><td><code>plaintext</code></td><td><code>bytes</code></td><td>The plaintext to encrypt and authenticate.</td></tr>
<tr><td><code>additionalData</code></td><td><code>bytes</code></td><td>The additional data to authenticate.</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes</code></td><td>The ciphertext with appended auth tag.</td></tr>
</tbody></table>
</div>
<h3 id="decrypt-1"><a class="header" href="#decrypt-1">decrypt</a></h3>
<p>Decrypt and authenticate the ciphertext and additional data using
DeoxysII. Reverts if the auth tag is incorrect.</p>
<h4 id="precompile-address-3"><a class="header" href="#precompile-address-3">Precompile address</a></h4>
<p><code>0x0100000000000000000000000000000000000004</code></p>
<h4 id="gas-cost-3"><a class="header" href="#gas-cost-3">Gas cost</a></h4>
<p>50,000 minimum plus 100 per word of input</p>
<h4 id="example-4"><a class="header" href="#example-4">Example</a></h4>
<pre><code class="language-solidity">bytes32 key = ... ;
bytes32 nonce = ... ;
bytes memory text = "plain text";
bytes memory ad = "additional data";
bytes memory encrypted = Sapphire.encrypt(key, nonce, text, ad);
bytes memory decrypted = Sapphire.decrypt(key, nonce, encrypted, ad);
</code></pre>
<pre><code class="language-solidity">function decrypt(bytes32 key, bytes32 nonce, bytes memory ciphertext, bytes memory additionalData)
    internal
    view
    returns (bytes memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>key</code></td><td><code>bytes32</code></td><td>The key to use for decryption.</td></tr>
<tr><td><code>nonce</code></td><td><code>bytes32</code></td><td>The nonce. Note that only the first 15 bytes of this parameter are used.</td></tr>
<tr><td><code>ciphertext</code></td><td><code>bytes</code></td><td>The ciphertext with tag to decrypt and authenticate.</td></tr>
<tr><td><code>additionalData</code></td><td><code>bytes</code></td><td>The additional data to authenticate against the ciphertext.</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes</code></td><td>The original plaintext.</td></tr>
</tbody></table>
</div>
<h3 id="generatesigningkeypair"><a class="header" href="#generatesigningkeypair">generateSigningKeyPair</a></h3>
<p>Generate a public/private key pair using the specified method and
seed. The available methods are items in the
<a href="contracts/Sapphire.sol/library.Sapphire.html#signingalg"><code>Sapphire.SigningAlg</code></a> enum. Note, however, that the
generation method ignores subvariants, so all three Ed25519-based are
equivalent, and all Secp256k1 &amp; Secp256r1 based methods are equivalent.
Sr25519 is not available and will return an error.</p>
<h4 id="precompile-address-4"><a class="header" href="#precompile-address-4">Precompile address</a></h4>
<p><code>0x0100000000000000000000000000000000000005</code></p>
<h4 id="gas-cost-4"><a class="header" href="#gas-cost-4">Gas Cost</a></h4>
<h5 id="ed25519-1000-gas"><a class="header" href="#ed25519-1000-gas">Ed25519: 1,000 gas</a></h5>
<ul>
<li><code>0</code> (<code>Ed25519Oasis</code>)</li>
<li><code>1</code> (<code>Ed25519Pure</code>)</li>
<li><code>2</code> (<code>Ed25519PrehashedSha512</code>)</li>
</ul>
<h5 id="secp256k1-1500-gas"><a class="header" href="#secp256k1-1500-gas">Secp256k1: 1,500 gas.</a></h5>
<ul>
<li><code>3</code> (<code>Secp256k1Oasis</code>)</li>
<li><code>4</code> (<code>Secp256k1PrehashedKeccak256</code>)</li>
<li><code>5</code> (<code>Secp256k1PrehashedSha256</code>)</li>
</ul>
<h5 id="secp256r1-4000-gas"><a class="header" href="#secp256r1-4000-gas">Secp256r1: 4,000 gas</a></h5>
<ul>
<li><code>7</code> (<code>Secp256r1PrehashedSha256</code>)</li>
</ul>
<h5 id="secp384r1-18000-gas"><a class="header" href="#secp384r1-18000-gas">Secp384r1: 18,000 gas</a></h5>
<ul>
<li><code>8</code> (<code>Secp384r1PrehashedSha384</code>)</li>
</ul>
<h4 id="key-formats"><a class="header" href="#key-formats">Key Formats</a></h4>
<h5 id="ed25519"><a class="header" href="#ed25519">Ed25519</a></h5>
<p>Public key: 32 bytes
Secret key: 32 bytes</p>
<h5 id="secp256k1--secp256r1"><a class="header" href="#secp256k1--secp256r1">Secp256k1 &amp; Secp256r1</a></h5>
<p>Public key: 33 bytes, compressed format (<code>0x02</code> or <code>0x03</code> prefix, then 32
byte X coordinate).
Secret key: 32 bytes</p>
<h5 id="secp384r1"><a class="header" href="#secp384r1">Secp384r1</a></h5>
<p>Public key: 49 bytes, compressed format (<code>0x02</code> or <code>0x03</code> prefix, then 48
byte X coordinate).
Secret key: 48 bytes</p>
<h4 id="example-5"><a class="header" href="#example-5">Example</a></h4>
<pre><code class="language-solidity">bytes memory seed = hex"0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef";
bytes memory publicKey;
bytes memory privateKey;
(publicKey, privateKey) = Sapphire.generateSigningKeyPair(Sapphire.SigningAlg.Ed25519Pure, seed);
</code></pre>
<pre><code class="language-solidity">function generateSigningKeyPair(SigningAlg alg, bytes memory seed)
    internal
    view
    returns (bytes memory publicKey, bytes memory secretKey);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>alg</code></td><td><code>SigningAlg</code></td><td>The signing alg for which to generate a keypair.</td></tr>
<tr><td><code>seed</code></td><td><code>bytes</code></td><td>The seed to use for generating the key pair. You can use the <code>randomBytes</code> method if you don't already have a seed.</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>publicKey</code></td><td><code>bytes</code></td><td>The public part of the keypair.</td></tr>
<tr><td><code>secretKey</code></td><td><code>bytes</code></td><td>The secret part of the keypair.</td></tr>
</tbody></table>
</div>
<h3 id="sign-4"><a class="header" href="#sign-4">sign</a></h3>
<p>Sign a message within the provided context using the specified
algorithm, and return the signature. The <code>contextOrHash</code> and
<code>message</code> parameters change in meaning slightly depending on the algorithm
requested:
For algorithms that use domain-separation contexts:</p>
<ul>
<li>Ed25519Oasis and Secp256k1Oasis: Pass the domain separator context string as
<code>contextOrHash</code> and the message to sign as <code>message</code>.
For algorithms that use pre-computed hashes:</li>
<li>Ed25519PrehashedSha512: Pass the SHA-512 hash (64 bytes) as <code>contextOrHash</code>
and set <code>message</code> to empty.</li>
<li>Secp256k1PrehashedKeccak256: Pass the Keccak256 hash (32 bytes) as <code>contextOrHash</code>
and set <code>message</code> to empty. The hash should be computed as <code>bytes memory hash = abi.encodePacked(keccak256(message))</code>.</li>
<li>Secp256k1PrehashedSha256: Pass the SHA-256 hash (32 bytes) as <code>contextOrHash</code>
and set <code>message</code> to empty.</li>
<li>Secp256r1PrehashedSha256: Pass the SHA-256 hash (32 bytes) as <code>contextOrHash</code>
and set <code>message</code> to empty.</li>
<li>Secp384r1PrehashedSha384: Pass the SHA-384 hash (48 bytes) as <code>contextOrHash</code>
and set <code>message</code> to empty.
For Sr25519 signatures (for Substrate compatibility):</li>
<li>Sr25519: You MUST pass "substrate" as the <code>contextOrHash</code> parameter to ensure
compatibility with Substrate off-chain signing that uses the <code>{ withType: true }</code>
parameter. Pass the message to sign as the <code>message</code> parameter.</li>
</ul>
<h4 id="precompile-address-5"><a class="header" href="#precompile-address-5">Precompile address</a></h4>
<p><code>0x0100000000000000000000000000000000000006</code></p>
<h4 id="gas-cost-5"><a class="header" href="#gas-cost-5">Gas cost</a></h4>
<p>See below for the method-dependent base cost, plus 8 gas per 32 bytes of
context and message except digest.</p>
<h4 id="signing-algorithms"><a class="header" href="#signing-algorithms">Signing algorithms</a></h4>
<ul>
<li><code>0</code> (<code>Ed25519Oasis</code>): 1,500 gas, variable length context and message.</li>
<li><code>1</code> (<code>Ed25519Pure</code>): 1,500 gas, empty context, variable length message.</li>
<li><code>2</code> (<code>Ed25519PrehashedSha512</code>): 1,500 gas, pre-existing SHA-512 hash
(64 bytes) as context, empty message.</li>
<li><code>3</code> (<code>Secp256k1Oasis</code>): 3,000 gas, variable length context and message</li>
<li><code>4</code> (<code>Secp256k1PrehashedKeccak256</code>): 3,000 gas, pre-existing hash
(32 bytes) as context, empty message.</li>
<li><code>5</code> (<code>Secp256k1PrehashedSha256</code>): 3,000 gas, pre-existing hash (32
bytes) as context, empty message.</li>
<li><code>7</code> (<code>Secp256r1PrehashedSha256</code>): 9,000 gas, pre-existing hash (32
bytes) as context, empty message.</li>
<li><code>8</code> (<code>Secp384r1PrehashedSha384</code>): 43,200 gas, pre-existing hash (48
bytes) as context, empty message.</li>
</ul>
<h4 id="example-6"><a class="header" href="#example-6">Example</a></h4>
<pre><code class="language-solidity">// Example 1: Signing with Ed25519Pure
Sapphire.SigningAlg alg = Sapphire.SigningAlg.Ed25519Pure;
bytes memory pk;
bytes memory sk;
(pk, sk) = Sapphire.generateSigningKeyPair(alg, Sapphire.randomBytes(32, ""));
bytes memory signature = Sapphire.sign(alg, sk, "", "signed message");
// Example 2: Signing with Secp256k1PrehashedKeccak256
alg = Sapphire.SigningAlg.Secp256k1PrehashedKeccak256;
bytes memory message = "message to sign";
bytes memory digest = abi.encodePacked(keccak256(message));
signature = Sapphire.sign(alg, sk, digest, "");
// Example 3: Signing with Sr25519 (Substrate compatibility)
alg = Sapphire.SigningAlg.Sr25519;
bytes memory message = "message to sign";
signature = Sapphire.sign(alg, sk, "substrate", message);
</code></pre>
<p><strong>Note:</strong>
see: @oasisprotocol/oasis-sdk :: precompile/confidential.rs :: call_sign</p>
<pre><code class="language-solidity">function sign(SigningAlg alg, bytes memory secretKey, bytes memory contextOrHash, bytes memory message)
    internal
    view
    returns (bytes memory signature);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>alg</code></td><td><code>SigningAlg</code></td><td>The signing algorithm to use.</td></tr>
<tr><td><code>secretKey</code></td><td><code>bytes</code></td><td>The secret key to use for signing. The key must be valid for use with the requested algorithm.</td></tr>
<tr><td><code>contextOrHash</code></td><td><code>bytes</code></td><td>Domain-Separator Context, or precomputed hash bytes. The format and meaning depends on the selected algorithm (see above).</td></tr>
<tr><td><code>message</code></td><td><code>bytes</code></td><td>Message to sign, should be zero-length if precomputed hash given.</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>signature</code></td><td><code>bytes</code></td><td>The resulting signature.</td></tr>
</tbody></table>
</div>
<h3 id="verify"><a class="header" href="#verify">verify</a></h3>
<p>Verifies that the provided digest was signed using the
secret key corresponding to the provided public key and the specified
signing algorithm.
The <code>contextOrHash</code> and <code>message</code> parameters behave the same way as in the
sign() function. Please refer to the <a href="contracts/Sapphire.sol/library.Sapphire.html#sign">sign()</a> function documentation
for details on how these parameters should be used with each algorithm.</p>
<h4 id="precompile-address-6"><a class="header" href="#precompile-address-6">Precompile address</a></h4>
<p><code>0x0100000000000000000000000000000000000007</code></p>
<h4 id="gas-cost-6"><a class="header" href="#gas-cost-6">Gas cost</a></h4>
<p>The algorithm-specific base cost below, with an additional <strong>8 gas per
32 bytes</strong> of <code>context</code> and <code>message</code> for the <code>Ed25519Oasis</code>,
<code>Ed25519Pure</code> and <code>Secp256k1Oasis</code> algorithms.</p>
<ul>
<li><code>0</code> (<code>Ed25519Oasis</code>): 2,000 gas</li>
<li><code>1</code> (<code>Ed25519Pure</code>): 2,000 gas</li>
<li><code>2</code> (<code>Ed25519PrehashedSha512</code>): 2,000 gas</li>
<li><code>3</code> (<code>Secp256k1Oasis</code>): 3,000 gas</li>
<li><code>4</code> (<code>Secp256k1PrehashedKeccak256</code>): 3,000 gas</li>
<li><code>5</code> (<code>Secp256k1PrehashedSha256</code>): 3,000 gas</li>
<li><code>7</code> (<code>Secp256r1PrehashedSha256</code>): 7,900 gas</li>
<li><code>8</code> (<code>Secp384r1PrehashedSha384</code>): 37,920 gas</li>
</ul>
<h4 id="example-7"><a class="header" href="#example-7">Example</a></h4>
<pre><code class="language-solidity">// Example 1: Verifying with Secp256k1PrehashedKeccak256
Sapphire.SigningAlg alg = Sapphire.SigningAlg.Secp256k1PrehashedKeccak256;
bytes memory pk;
bytes memory sk;
bytes memory message = "message to sign";
// Create the hash
bytes memory digest = abi.encodePacked(keccak256(message));
// Generate keys and sign
(pk, sk) = Sapphire.generateSigningKeyPair(alg, Sapphire.randomBytes(32, ""));
bytes memory signature = Sapphire.sign(alg, sk, digest, "");
// Verify the signature (pass the same hash used for signing)
bool isValid = Sapphire.verify(alg, pk, digest, "", signature);
require(isValid, "Invalid signature");
// Example 2: Verifying with Sr25519 (Substrate compatibility)
alg = Sapphire.SigningAlg.Sr25519;
message = "message to sign";
// Sign with "substrate" context
signature = Sapphire.sign(alg, sk, "substrate", message);
// Verify with the same "substrate" context
isValid = Sapphire.verify(alg, pk, "substrate", message, signature);
require(isValid, "Invalid signature");
</code></pre>
<p><strong>Note:</strong>
see: @oasisprotocol/oasis-sdk :: precompile/confidential.rs :: call_verify</p>
<pre><code class="language-solidity">function verify(
    SigningAlg alg,
    bytes memory publicKey,
    bytes memory contextOrHash,
    bytes memory message,
    bytes memory signature
) internal view returns (bool verified);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>alg</code></td><td><code>SigningAlg</code></td><td>The signing algorithm by which the signature was generated.</td></tr>
<tr><td><code>publicKey</code></td><td><code>bytes</code></td><td>The public key against which to check the signature.</td></tr>
<tr><td><code>contextOrHash</code></td><td><code>bytes</code></td><td>Domain-Separator Context, or precomputed hash bytes. The format and meaning depends on the selected algorithm (see above).</td></tr>
<tr><td><code>message</code></td><td><code>bytes</code></td><td>The message that was signed, should be zero-length if precomputed hash was given in contextOrHash.</td></tr>
<tr><td><code>signature</code></td><td><code>bytes</code></td><td>The signature to verify.</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>verified</code></td><td><code>bool</code></td><td>Whether the signature is valid for the given parameters.</td></tr>
</tbody></table>
</div>
<h3 id="padgas"><a class="header" href="#padgas">padGas</a></h3>
<p>Set the current transactions gas usage to a specific amount</p>
<p>Will cause a reversion if the current usage is more than the amount.</p>
<p><strong>Note:</strong>
see: @oasisprotocol/oasis-sdk :: precompile/gas.rs :: call_pad_gas</p>
<pre><code class="language-solidity">function padGas(uint128 toAmount) internal view;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>toAmount</code></td><td><code>uint128</code></td><td>Gas usage will be set to this amount</td></tr>
</tbody></table>
</div>
<h3 id="gasused"><a class="header" href="#gasused">gasUsed</a></h3>
<p>Returns the amount of gas currently used by the transaction</p>
<p><strong>Note:</strong>
see: @oasisprotocol/oasis-sdk :: precompile/gas.rs :: call_gas_used</p>
<pre><code class="language-solidity">function gasUsed() internal view returns (uint64);
</code></pre>
<h2 id="enums"><a class="header" href="#enums">Enums</a></h2>
<h3 id="signingalg"><a class="header" href="#signingalg">SigningAlg</a></h3>
<pre><code class="language-solidity">enum SigningAlg {
    /// Ed25519 signature over the provided message using SHA-512/265 with a domain separator.
    /// Can be used to sign transactions for the Oasis consensus layer and SDK paratimes.
    Ed25519Oasis,
    /// Ed25519 signature over the provided message.
    Ed25519Pure,
    /// Ed25519 signature over the provided prehashed SHA-512 digest.
    Ed25519PrehashedSha512,
    /// Secp256k1 signature over the provided message using SHA-512/256 with a domain separator.
    /// Can be used to sign transactions for the Oasis consensus layer and SDK paratimes.
    Secp256k1Oasis,
    /// Secp256k1 over the provided Keccak256 digest.
    /// Can be used to sign transactions for Ethereum-compatible networks.
    Secp256k1PrehashedKeccak256,
    /// Secp256k1 signature over the provided SHA-256 digest.
    Secp256k1PrehashedSha256,
    /// Sr25519 signature over the provided message.
    Sr25519,
    /// Secp256r1 signature over the provided SHA-256 digest.
    Secp256r1PrehashedSha256,
    /// Secp384r1 signature over the provided SHA-384 digest.
    Secp384r1PrehashedSha384
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sha384-1"><a class="header" href="#sha384-1">sha384</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/Sapphire.sol">Git Source</a></p>
<p>Hash the input data with SHA-384.</p>
<p><strong>Notes:</strong></p>
<ul>
<li>
<p>standard: https://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.180-4.pdf</p>
</li>
<li>
<p>see: @oasisprotocol/oasis-sdk :: precompile/sha2.rs :: call_sha384</p>
</li>
</ul>
<pre><code class="language-solidity">function sha384(bytes memory input) view returns (bytes memory output);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>input</code></td><td><code>bytes</code></td><td>Bytes to hash.</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>output</code></td><td><code>bytes</code></td><td>48 byte digest.</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="sha512-1"><a class="header" href="#sha512-1">sha512</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/Sapphire.sol">Git Source</a></p>
<p>Hash the input data with SHA-512, according to
<a href="https://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.180-4.pdf">NIST.FIPS.180-4</a></p>
<h4 id="precompile-address-7"><a class="header" href="#precompile-address-7">Precompile address</a></h4>
<p><code>0x0100000000000000000000000000000000000101</code></p>
<h4 id="warning-sha-512-vs-sha-512256-length-extension-attacks"><a class="header" href="#warning-sha-512-vs-sha-512256-length-extension-attacks">Warning: SHA-512 vs SHA-512/256 Length-Extension Attacks</a></h4>
<p><a href="contracts/Sapphire.sol/function.sha512.html#sha512">SHA-512</a> is vulnerable to <a href="https://en.wikipedia.org/wiki/Length_extension_attack">length-extension
attacks</a>, which are
relevant if you are computing the hash of a secret message. The
<a href="contracts/Sapphire.sol/function.sha512_256.html#sha512_256">SHA-512/256</a> variant is <strong>not</strong>
vulnerable to length-extension attacks.</p>
<h4 id="gas-cost-7"><a class="header" href="#gas-cost-7">Gas Cost</a></h4>
<p>115 gas, then 13 gas per word</p>
<h4 id="example-8"><a class="header" href="#example-8">Example</a></h4>
<pre><code class="language-solidity">bytes memory result = sha512(abi.encodePacked("input data"));
</code></pre>
<p><strong>Notes:</strong></p>
<ul>
<li>
<p>standard: https://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.180-4.pdf</p>
</li>
<li>
<p>see: @oasisprotocol/oasis-sdk :: precompile/sha2.rs :: call_sha512</p>
</li>
</ul>
<pre><code class="language-solidity">function sha512(bytes memory input) view returns (bytes memory output);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>input</code></td><td><code>bytes</code></td><td>Bytes to hash.</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>output</code></td><td><code>bytes</code></td><td>64 byte digest.</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="sha512_256-1"><a class="header" href="#sha512_256-1">sha512_256</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/Sapphire.sol">Git Source</a></p>
<p>Hash the input data with SHA-512/256, according to
<a href="https://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.180-4.pdf">NIST.FIPS.180-4</a>.</p>
<h4 id="precompile-address-8"><a class="header" href="#precompile-address-8">Precompile address</a></h4>
<p><code>0x0100000000000000000000000000000000000102</code></p>
<h4 id="gas-cost-8"><a class="header" href="#gas-cost-8">Gas cost</a></h4>
<p>115 gas, then 13 gas per word</p>
<h4 id="example-9"><a class="header" href="#example-9">Example</a></h4>
<pre><code class="language-solidity">bytes32 result = sha512_256(abi.encodePacked("input data"));
</code></pre>
<h4 id="warning-sha-512-vs-sha-512256-length-extension-attacks-1"><a class="header" href="#warning-sha-512-vs-sha-512256-length-extension-attacks-1">Warning: SHA-512 vs SHA-512/256 Length-Extension Attacks</a></h4>
<p><a href="contracts/Sapphire.sol/function.sha512.html#sha512">SHA-512</a> is vulnerable to <a href="https://en.wikipedia.org/wiki/Length_extension_attack">length-extension
attacks</a>, which are
relevant if you are computing the hash of a secret message. The
<a href="contracts/Sapphire.sol/function.sha512_256.html#sha512_256">SHA-512/256</a> variant is <strong>not</strong>
vulnerable to length-extension attacks.</p>
<p><strong>Notes:</strong></p>
<ul>
<li>
<p>standard: https://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.180-4.pdf</p>
</li>
<li>
<p>see: @oasisprotocol/oasis-sdk :: precompile/sha2.rs :: call_sha512_256</p>
</li>
</ul>
<pre><code class="language-solidity">function sha512_256(bytes memory input) view returns (bytes32 result);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>input</code></td><td><code>bytes</code></td><td>Bytes to hash.</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>result</code></td><td><code>bytes32</code></td><td>32 byte digest.</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="parsedsiwemessage"><a class="header" href="#parsedsiwemessage">ParsedSiweMessage</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/SiweParser.sol">Git Source</a></p>
<pre><code class="language-solidity">struct ParsedSiweMessage {
bytes schemeDomain;
address addr;
bytes statement;
bytes uri;
bytes version;
uint256 chainId;
bytes nonce;
bytes issuedAt;
bytes expirationTime;
bytes notBefore;
bytes requestId;
bytes[] resources;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="siweparser"><a class="header" href="#siweparser">SiweParser</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/SiweParser.sol">Git Source</a></p>
<p><strong>Title:</strong>
On-chain parser for EIP-4361 SIWE message</p>
<p>Call parseSiweMsg() and provide the EIP-4361 SIWE message. The parser
will generate the ParsedSiweMessage struct which you can then use to
extract the authentication information in your on-chain contract.</p>
<h2 id="functions-16"><a class="header" href="#functions-16">Functions</a></h2>
<h3 id="_hexstringtoaddress"><a class="header" href="#_hexstringtoaddress">_hexStringToAddress</a></h3>
<p>Convert string containing hex address without 0x prefix to solidity address object.</p>
<pre><code class="language-solidity">function _hexStringToAddress(bytes memory s) internal pure returns (address);
</code></pre>
<h3 id="_fromhexchar"><a class="header" href="#_fromhexchar">_fromHexChar</a></h3>
<pre><code class="language-solidity">function _fromHexChar(uint8 c) internal pure returns (uint8);
</code></pre>
<h3 id="_substr"><a class="header" href="#_substr">_substr</a></h3>
<p>Substring.</p>
<pre><code class="language-solidity">function _substr(bytes memory str, uint256 startIndex, uint256 endIndex) internal pure returns (bytes memory);
</code></pre>
<h3 id="_parseuint"><a class="header" href="#_parseuint">_parseUint</a></h3>
<p>String to Uint using decimal format. No error handling.</p>
<pre><code class="language-solidity">function _parseUint(bytes memory b) internal pure returns (uint256);
</code></pre>
<h3 id="_parsefield"><a class="header" href="#_parsefield">_parseField</a></h3>
<p>Parse "NAME: VALUE" in str starting at index i and ending at \n or end of bytes.</p>
<pre><code class="language-solidity">function _parseField(bytes calldata str, string memory name, uint256 i)
    internal
    pure
    returns (bytes memory, uint256);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes</code></td><td>VALUE and new i, if NAME matched; otherwise empty value and old i.</td></tr>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td></td></tr>
</tbody></table>
</div>
<h3 id="_parsearray"><a class="header" href="#_parsearray">_parseArray</a></h3>
<p>Parse bullets, one per line in str starting at i.</p>
<pre><code class="language-solidity">function _parseArray(bytes calldata str, uint256 i) internal pure returns (bytes[] memory, uint256);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes[]</code></td><td>Array of parsed values and a new i.</td></tr>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td></td></tr>
</tbody></table>
</div>
<h3 id="parsesiwemsg"><a class="header" href="#parsesiwemsg">parseSiweMsg</a></h3>
<p>Parse SIWE message.</p>
<pre><code class="language-solidity">function parseSiweMsg(bytes calldata siweMsg) internal pure returns (ParsedSiweMessage memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>ParsedSiweMessage</code></td><td>ParsedSiweMessage struct with populated fields from the message.</td></tr>
</tbody></table>
</div>
<h3 id="timestampfromiso"><a class="header" href="#timestampfromiso">timestampFromIso</a></h3>
<p>Parse RFC 3339 (ISO 8601) string to timestamp.</p>
<pre><code class="language-solidity">function timestampFromIso(bytes memory str) internal pure returns (uint256);
</code></pre>
<h2 id="errors-3"><a class="header" href="#errors-3">Errors</a></h2>
<h3 id="siweparser_invalidaddresslength"><a class="header" href="#siweparser_invalidaddresslength">SiweParser_InvalidAddressLength</a></h3>
<p>Invalid length of the hex-encoded address</p>
<pre><code class="language-solidity">error SiweParser_InvalidAddressLength();
</code></pre>
<h3 id="siweparser_invalidnonce"><a class="header" href="#siweparser_invalidnonce">SiweParser_InvalidNonce</a></h3>
<p>Invalid length of the nonce</p>
<pre><code class="language-solidity">error SiweParser_InvalidNonce();
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="subcallreceiptkind"><a class="header" href="#subcallreceiptkind">SubcallReceiptKind</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/Subcall.sol">Git Source</a></p>
<pre><code class="language-solidity">enum SubcallReceiptKind {
Invalid,
Delegate,
UndelegateStart,
UndelegateDone
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="subcall"><a class="header" href="#subcall">Subcall</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/Subcall.sol">Git Source</a></p>
<p><strong>Title:</strong>
SDK Subcall wrappers</p>
<p>Interact with Oasis Runtime SDK modules from Sapphire.</p>
<h2 id="state-variables-7"><a class="header" href="#state-variables-7">State Variables</a></h2>
<h3 id="consensus_delegate"><a class="header" href="#consensus_delegate">CONSENSUS_DELEGATE</a></h3>
<pre><code class="language-solidity">string private constant CONSENSUS_DELEGATE = "consensus.Delegate"
</code></pre>
<h3 id="consensus_undelegate"><a class="header" href="#consensus_undelegate">CONSENSUS_UNDELEGATE</a></h3>
<pre><code class="language-solidity">string private constant CONSENSUS_UNDELEGATE = "consensus.Undelegate"
</code></pre>
<h3 id="consensus_withdraw"><a class="header" href="#consensus_withdraw">CONSENSUS_WITHDRAW</a></h3>
<pre><code class="language-solidity">string private constant CONSENSUS_WITHDRAW = "consensus.Withdraw"
</code></pre>
<h3 id="consensus_take_receipt"><a class="header" href="#consensus_take_receipt">CONSENSUS_TAKE_RECEIPT</a></h3>
<pre><code class="language-solidity">string private constant CONSENSUS_TAKE_RECEIPT = "consensus.TakeReceipt"
</code></pre>
<h3 id="accounts_transfer"><a class="header" href="#accounts_transfer">ACCOUNTS_TRANSFER</a></h3>
<pre><code class="language-solidity">string private constant ACCOUNTS_TRANSFER = "accounts.Transfer"
</code></pre>
<h3 id="core_calldatapublickey"><a class="header" href="#core_calldatapublickey">CORE_CALLDATAPUBLICKEY</a></h3>
<pre><code class="language-solidity">string private constant CORE_CALLDATAPUBLICKEY = "core.CallDataPublicKey"
</code></pre>
<h3 id="core_current_epoch"><a class="header" href="#core_current_epoch">CORE_CURRENT_EPOCH</a></h3>
<pre><code class="language-solidity">string private constant CORE_CURRENT_EPOCH = "core.CurrentEpoch"
</code></pre>
<h3 id="rofl_is_authorized_origin"><a class="header" href="#rofl_is_authorized_origin">ROFL_IS_AUTHORIZED_ORIGIN</a></h3>
<pre><code class="language-solidity">string private constant ROFL_IS_AUTHORIZED_ORIGIN = "rofl.IsAuthorizedOrigin"
</code></pre>
<h3 id="rofl_origin_app"><a class="header" href="#rofl_origin_app">ROFL_ORIGIN_APP</a></h3>
<pre><code class="language-solidity">string private constant ROFL_ORIGIN_APP = "rofl.OriginApp"
</code></pre>
<h3 id="subcall-1"><a class="header" href="#subcall-1">SUBCALL</a></h3>
<p>Address of the SUBCALL precompile</p>
<pre><code class="language-solidity">address internal constant SUBCALL = 0x0100000000000000000000000000000000000103
</code></pre>
<h2 id="functions-17"><a class="header" href="#functions-17">Functions</a></h2>
<h3 id="subcall-2"><a class="header" href="#subcall-2">subcall</a></h3>
<p>Submit a native message to the Oasis runtime layer. Messages
which re-enter the EVM module are forbidden: <code>evm.*</code>.</p>
<pre><code class="language-solidity">function subcall(string memory method, bytes memory body) internal returns (uint64 status, bytes memory data);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>method</code></td><td><code>string</code></td><td>Native message type.</td></tr>
<tr><td><code>body</code></td><td><code>bytes</code></td><td>CBOR encoded body.</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>status</code></td><td><code>uint64</code></td><td>Result of call.</td></tr>
<tr><td><code>data</code></td><td><code>bytes</code></td><td>CBOR encoded result.</td></tr>
</tbody></table>
</div>
<h3 id="subcall_static"><a class="header" href="#subcall_static">subcall_static</a></h3>
<p>Submit a read-only native message to the Oasis runtime layer using STATICCALL.
Messages which re-enter the EVM module are forbidden: <code>evm.*</code>.</p>
<pre><code class="language-solidity">function subcall_static(string memory method, bytes memory body)
    internal
    view
    returns (uint64 status, bytes memory data);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>method</code></td><td><code>string</code></td><td>Native message type.</td></tr>
<tr><td><code>body</code></td><td><code>bytes</code></td><td>CBOR encoded body.</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>status</code></td><td><code>uint64</code></td><td>Result of call.</td></tr>
<tr><td><code>data</code></td><td><code>bytes</code></td><td>CBOR encoded result.</td></tr>
</tbody></table>
</div>
<h3 id="_subcallwithtoandamount"><a class="header" href="#_subcallwithtoandamount">_subcallWithToAndAmount</a></h3>
<p>Generic method to call <code>{to:address, amount:uint128}</code>.</p>
<pre><code class="language-solidity">function _subcallWithToAndAmount(string memory method, StakingAddress to, uint128 value, bytes memory token)
    internal
    returns (uint64 status, bytes memory data);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>method</code></td><td><code>string</code></td><td>Runtime SDK method name ('module.Action').</td></tr>
<tr><td><code>to</code></td><td><code>StakingAddress</code></td><td>Destination address.</td></tr>
<tr><td><code>value</code></td><td><code>uint128</code></td><td>Amount specified.</td></tr>
<tr><td><code>token</code></td><td><code>bytes</code></td><td></td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>status</code></td><td><code>uint64</code></td><td>Non-zero on error.</td></tr>
<tr><td><code>data</code></td><td><code>bytes</code></td><td>Module name on error.</td></tr>
</tbody></table>
</div>
<h3 id="consensustakereceipt"><a class="header" href="#consensustakereceipt">consensusTakeReceipt</a></h3>
<p>Returns a CBOR encoded structure, containing the following
possible keys. All keys are optional:</p>
<ul>
<li>shares: <code>u128</code></li>
<li>epoch: <code>EpochTime</code></li>
<li>receipt: <code>u64</code></li>
<li>amount: <code>u128</code></li>
<li>error: <code>{module: string, code: u32}</code></li>
</ul>
<h4 id="keys-returned-by-specific-subcalls"><a class="header" href="#keys-returned-by-specific-subcalls">Keys returned by specific subcalls</a></h4>
<ul>
<li><code>Delegate</code> will have the <code>error</code> or <code>shares</code> keys.</li>
<li><code>UndelegateStart</code> will have the <code>epoch</code> and <code>receipt</code> keys.</li>
<li><code>UndelegateDone</code> will have the <code>amount</code> key.</li>
</ul>
<pre><code class="language-solidity">function consensusTakeReceipt(SubcallReceiptKind kind, uint64 receiptId) internal returns (bytes memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>kind</code></td><td><code>SubcallReceiptKind</code></td><td><code>1</code> (<code>Delegate</code>), <code>2</code> (<code>UndelegateStart</code>) or <code>3</code> (<code>UndelegateDone</code>)</td></tr>
<tr><td><code>receiptId</code></td><td><code>uint64</code></td><td>ID of receipt</td></tr>
</tbody></table>
</div>
<h3 id="_decodereceiptundelegatestart"><a class="header" href="#_decodereceiptundelegatestart">_decodeReceiptUndelegateStart</a></h3>
<pre><code class="language-solidity">function _decodeReceiptUndelegateStart(bytes memory result)
    internal
    pure
    returns (uint64 epoch, uint64 endReceipt);
</code></pre>
<h3 id="_decodereceiptundelegatedone"><a class="header" href="#_decodereceiptundelegatedone">_decodeReceiptUndelegateDone</a></h3>
<pre><code class="language-solidity">function _decodeReceiptUndelegateDone(bytes memory result) internal pure returns (uint128 amount);
</code></pre>
<h3 id="_decodereceiptdelegate"><a class="header" href="#_decodereceiptdelegate">_decodeReceiptDelegate</a></h3>
<p>Decodes a 'Delegate' receipt.</p>
<pre><code class="language-solidity">function _decodeReceiptDelegate(uint64 receiptId, bytes memory result) internal pure returns (uint128 shares);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>receiptId</code></td><td><code>uint64</code></td><td>Previously unretrieved receipt.</td></tr>
<tr><td><code>result</code></td><td><code>bytes</code></td><td>CBOR encoded {shares: u128}.</td></tr>
</tbody></table>
</div>
<h3 id="consensustakereceiptdelegate"><a class="header" href="#consensustakereceiptdelegate">consensusTakeReceiptDelegate</a></h3>
<pre><code class="language-solidity">function consensusTakeReceiptDelegate(uint64 receiptId) internal returns (uint128 shares);
</code></pre>
<h3 id="consensustakereceiptundelegatestart"><a class="header" href="#consensustakereceiptundelegatestart">consensusTakeReceiptUndelegateStart</a></h3>
<pre><code class="language-solidity">function consensusTakeReceiptUndelegateStart(uint64 receiptId) internal returns (uint64 epoch, uint64 endReceipt);
</code></pre>
<h3 id="consensustakereceiptundelegatedone"><a class="header" href="#consensustakereceiptundelegatedone">consensusTakeReceiptUndelegateDone</a></h3>
<pre><code class="language-solidity">function consensusTakeReceiptUndelegateDone(uint64 receiptId) internal returns (uint128 amount);
</code></pre>
<h3 id="consensusundelegate"><a class="header" href="#consensusundelegate">consensusUndelegate</a></h3>
<p>Start the undelegation process of the given number of shares from
consensus staking account to runtime account.</p>
<pre><code class="language-solidity">function consensusUndelegate(StakingAddress from, uint128 shares) internal;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>from</code></td><td><code>StakingAddress</code></td><td>Consensus address which shares were delegated to.</td></tr>
<tr><td><code>shares</code></td><td><code>uint128</code></td><td>Number of shares to withdraw back to us.</td></tr>
</tbody></table>
</div>
<h3 id="consensusundelegate-1"><a class="header" href="#consensusundelegate-1">consensusUndelegate</a></h3>
<pre><code class="language-solidity">function consensusUndelegate(StakingAddress from, uint128 shares, uint64 receiptId) internal;
</code></pre>
<h3 id="consensusdelegate"><a class="header" href="#consensusdelegate">consensusDelegate</a></h3>
<p>Delegate native token to consensus level.</p>
<pre><code class="language-solidity">function consensusDelegate(StakingAddress to, uint128 amount) internal returns (bytes memory data);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>to</code></td><td><code>StakingAddress</code></td><td>Consensus address shares are delegated to.</td></tr>
<tr><td><code>amount</code></td><td><code>uint128</code></td><td>Native token amount (in wei).</td></tr>
</tbody></table>
</div>
<h3 id="consensusdelegate-1"><a class="header" href="#consensusdelegate-1">consensusDelegate</a></h3>
<p>Delegate native token to consensus level. Requests that the
number of shares allocated can be retrieved with a receipt. The receipt
will be of <code>ReceiptKind.DelegateDone</code> and can be decoded using
<code>decodeReceiptDelegateDone</code>.</p>
<pre><code class="language-solidity">function consensusDelegate(StakingAddress to, uint128 amount, uint64 receiptId)
    internal
    returns (bytes memory data);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>to</code></td><td><code>StakingAddress</code></td><td>Consensus address shares are delegated to.</td></tr>
<tr><td><code>amount</code></td><td><code>uint128</code></td><td>Native token amount (in wei).</td></tr>
<tr><td><code>receiptId</code></td><td><code>uint64</code></td><td>contract-specific receipt to retrieve result.</td></tr>
</tbody></table>
</div>
<h3 id="consensuswithdraw"><a class="header" href="#consensuswithdraw">consensusWithdraw</a></h3>
<p>Transfer from an account in this runtime to a consensus staking
account.</p>
<pre><code class="language-solidity">function consensusWithdraw(StakingAddress to, uint128 value) internal;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>to</code></td><td><code>StakingAddress</code></td><td>Consensus address which gets the tokens.</td></tr>
<tr><td><code>value</code></td><td><code>uint128</code></td><td>Token amount (in wei).</td></tr>
</tbody></table>
</div>
<h3 id="accountstransfer"><a class="header" href="#accountstransfer">accountsTransfer</a></h3>
<p>Perform a transfer to another account. This is equivalent of
<code>payable(to).transfer(value);</code>.</p>
<pre><code class="language-solidity">function accountsTransfer(address to, uint128 value) internal;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>to</code></td><td><code>address</code></td><td>Destination account.</td></tr>
<tr><td><code>value</code></td><td><code>uint128</code></td><td>native token amount (in wei).</td></tr>
</tbody></table>
</div>
<h3 id="roflensureauthorizedorigin"><a class="header" href="#roflensureauthorizedorigin">roflEnsureAuthorizedOrigin</a></h3>
<p>Verify whether the origin transaction is signed by an authorized
ROFL instance for the given application.</p>
<pre><code class="language-solidity">function roflEnsureAuthorizedOrigin(bytes21 appId) internal view;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>appId</code></td><td><code>bytes21</code></td><td>ROFL app identifier</td></tr>
</tbody></table>
</div>
<h3 id="getroflappid"><a class="header" href="#getroflappid">getRoflAppId</a></h3>
<p>Get the ROFL app identifier for the current origin transaction.</p>
<h4 id="example-10"><a class="header" href="#example-10">Example</a></h4>
<pre><code class="language-solidity">// Store ROFL app-specific price observation.
mapping(bytes21 =&gt; uint32) private observations;
...
observations[Subcall.getRoflAppId()] = 25540;
</code></pre>
<pre><code class="language-solidity">function getRoflAppId() internal view returns (bytes21 appId);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>appId</code></td><td><code>bytes21</code></td><td>The 21-byte ROFL application identifier</td></tr>
</tbody></table>
</div>
<h3 id="_parsecborpublickeyinner"><a class="header" href="#_parsecborpublickeyinner">_parseCBORPublicKeyInner</a></h3>
<pre><code class="language-solidity">function _parseCBORPublicKeyInner(bytes memory in_data, uint256 in_offset)
    internal
    pure
    returns (uint256 offset, CallDataPublicKey memory public_key);
</code></pre>
<h3 id="_parsecborcalldatapublickey"><a class="header" href="#_parsecborcalldatapublickey">_parseCBORCallDataPublicKey</a></h3>
<pre><code class="language-solidity">function _parseCBORCallDataPublicKey(bytes memory in_data)
    internal
    pure
    returns (uint256 epoch, CallDataPublicKey memory public_key);
</code></pre>
<h3 id="corecalldatapublickey"><a class="header" href="#corecalldatapublickey">coreCallDataPublicKey</a></h3>
<pre><code class="language-solidity">function coreCallDataPublicKey() internal view returns (uint256 epoch, CallDataPublicKey memory public_key);
</code></pre>
<h3 id="corecurrentepoch"><a class="header" href="#corecurrentepoch">coreCurrentEpoch</a></h3>
<pre><code class="language-solidity">function coreCurrentEpoch() internal view returns (uint256);
</code></pre>
<h2 id="errors-4"><a class="header" href="#errors-4">Errors</a></h2>
<h3 id="subcallerror"><a class="header" href="#subcallerror">SubcallError</a></h3>
<p>Raised if the underlying subcall precompile does not succeed</p>
<pre><code class="language-solidity">error SubcallError();
</code></pre>
<h3 id="parsereceipterror"><a class="header" href="#parsereceipterror">ParseReceiptError</a></h3>
<p>There was an error parsing the receipt</p>
<pre><code class="language-solidity">error ParseReceiptError(uint64 receiptId);
</code></pre>
<h3 id="consensusundelegateerror"><a class="header" href="#consensusundelegateerror">ConsensusUndelegateError</a></h3>
<pre><code class="language-solidity">error ConsensusUndelegateError(uint64 status, string data);
</code></pre>
<h3 id="consensusdelegateerror"><a class="header" href="#consensusdelegateerror">ConsensusDelegateError</a></h3>
<pre><code class="language-solidity">error ConsensusDelegateError(uint64 status, string data);
</code></pre>
<h3 id="consensustakereceipterror"><a class="header" href="#consensustakereceipterror">ConsensusTakeReceiptError</a></h3>
<pre><code class="language-solidity">error ConsensusTakeReceiptError(uint64 status, string data);
</code></pre>
<h3 id="consensuswithdrawerror"><a class="header" href="#consensuswithdrawerror">ConsensusWithdrawError</a></h3>
<pre><code class="language-solidity">error ConsensusWithdrawError(uint64 status, string data);
</code></pre>
<h3 id="accountstransfererror"><a class="header" href="#accountstransfererror">AccountsTransferError</a></h3>
<pre><code class="language-solidity">error AccountsTransferError(uint64 status, string data);
</code></pre>
<h3 id="wrongmapsizeerror"><a class="header" href="#wrongmapsizeerror">WrongMapSizeError</a></h3>
<p>Expected map of different size!</p>
<pre><code class="language-solidity">error WrongMapSizeError();
</code></pre>
<h3 id="takereceiptkindoutofrange"><a class="header" href="#takereceiptkindoutofrange">TakeReceiptKindOutOfRange</a></h3>
<p>Unknown type of receipt!</p>
<pre><code class="language-solidity">error TakeReceiptKindOutOfRange(uint256 receiptKind);
</code></pre>
<h3 id="rofloriginnotauthorizedforapp"><a class="header" href="#rofloriginnotauthorizedforapp">RoflOriginNotAuthorizedForApp</a></h3>
<p>The origin is not authorized for the given ROFL app</p>
<pre><code class="language-solidity">error RoflOriginNotAuthorizedForApp();
</code></pre>
<h3 id="tokennametoolong"><a class="header" href="#tokennametoolong">TokenNameTooLong</a></h3>
<p>Name of token cannot be CBOR encoded with current functions</p>
<pre><code class="language-solidity">error TokenNameTooLong();
</code></pre>
<h3 id="invalidreceiptid"><a class="header" href="#invalidreceiptid">InvalidReceiptId</a></h3>
<p>Invalid receipt ID</p>
<pre><code class="language-solidity">error InvalidReceiptId();
</code></pre>
<h3 id="missingkey"><a class="header" href="#missingkey">MissingKey</a></h3>
<p>CBOR parser expected a key, but it was not found in the map!</p>
<pre><code class="language-solidity">error MissingKey();
</code></pre>
<h3 id="incompleteparse"><a class="header" href="#incompleteparse">IncompleteParse</a></h3>
<p>We expected to have parsed everything, but there are excess bytes!</p>
<pre><code class="language-solidity">error IncompleteParse();
</code></pre>
<h3 id="corecurrentepocherror"><a class="header" href="#corecurrentepocherror">CoreCurrentEpochError</a></h3>
<p>Error while trying to retrieve current epoch</p>
<pre><code class="language-solidity">error CoreCurrentEpochError(uint64);
</code></pre>
<h3 id="corecalldatapublickeyerror"><a class="header" href="#corecalldatapublickeyerror">CoreCallDataPublicKeyError</a></h3>
<p>Error while trying to retrieve the calldata public key</p>
<pre><code class="language-solidity">error CoreCallDataPublicKeyError(uint64);
</code></pre>
<h2 id="structs-4"><a class="header" href="#structs-4">Structs</a></h2>
<h3 id="calldatapublickey"><a class="header" href="#calldatapublickey">CallDataPublicKey</a></h3>
<pre><code class="language-solidity">struct CallDataPublicKey {
    bytes32 key;
    bytes32 checksum;
    bytes32[2] signature;
    uint256 expiration;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="wrappedrose"><a class="header" href="#wrappedrose">WrappedROSE</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/WrappedROSE.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
ERC20, ERC20Burnable</p>
<h2 id="functions-18"><a class="header" href="#functions-18">Functions</a></h2>
<h3 id="constructor-5"><a class="header" href="#constructor-5">constructor</a></h3>
<pre><code class="language-solidity">constructor() ERC20("Wrapped ROSE", "wROSE");
</code></pre>
<h3 id="deposit"><a class="header" href="#deposit">deposit</a></h3>
<pre><code class="language-solidity">function deposit() external payable;
</code></pre>
<h3 id="withdraw"><a class="header" href="#withdraw">withdraw</a></h3>
<pre><code class="language-solidity">function withdraw(uint256 amount) external;
</code></pre>
<h3 id="receive"><a class="header" href="#receive">receive</a></h3>
<pre><code class="language-solidity">receive() external payable;
</code></pre>
<h3 id="_deposit"><a class="header" href="#_deposit">_deposit</a></h3>
<pre><code class="language-solidity">function _deposit() internal;
</code></pre>
<h2 id="events"><a class="header" href="#events">Events</a></h2>
<h3 id="deposit-1"><a class="header" href="#deposit-1">Deposit</a></h3>
<pre><code class="language-solidity">event Deposit(address indexed dst, uint256 wad);
</code></pre>
<h3 id="withdrawal"><a class="header" href="#withdrawal">Withdrawal</a></h3>
<pre><code class="language-solidity">event Withdrawal(address indexed src, uint256 wad);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="hmac_sha512_256_memcpy"><a class="header" href="#hmac_sha512_256_memcpy">hmac_sha512_256_memcpy</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/hmac_sha512_256.sol">Git Source</a></p>
<p>Copying key buffer failed (identity precompile error?)</p>
<pre><code class="language-solidity">error hmac_sha512_256_memcpy();
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="hmac_sha512_256"><a class="header" href="#hmac_sha512_256">hmac_sha512_256</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/hmac_sha512_256.sol">Git Source</a></p>
<p>Implements HMAC using SHA512-256.</p>
<p>https://en.wikipedia.org/wiki/HMAC</p>
<pre><code class="language-solidity">function hmac_sha512_256(bytes memory key, bytes memory message) view returns (bytes32);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>key</code></td><td><code>bytes</code></td><td>the secret key.</td></tr>
<tr><td><code>message</code></td><td><code>bytes</code></td><td>the message to be authenticated. #### Example <code>solidity bytes memory key = "arbitrary length key"; bytes memory message = "arbitrary length message"; bytes32 hmac = hmac_sha512_256(key, message) </code></td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="constants"><a class="header" href="#constants">Constants</a></h1>
<p><a href="https://github.com/oasisprotocol/sapphire-paratime/blob/dc293c9f6fdc061343c1a33a608e341dc31e747d/contracts/contracts/hmac_sha512_256.sol">Git Source</a></p>
<h3 id="sha512_256_block_size"><a class="header" href="#sha512_256_block_size">SHA512_256_BLOCK_SIZE</a></h3>
<pre><code class="language-solidity">uint256 constant SHA512_256_BLOCK_SIZE = 128
</code></pre>
<h3 id="precompile_identity_address"><a class="header" href="#precompile_identity_address">PRECOMPILE_IDENTITY_ADDRESS</a></h3>
<pre><code class="language-solidity">uint256 constant PRECOMPILE_IDENTITY_ADDRESS = 4
</code></pre>
<h3 id="hmac_ipad"><a class="header" href="#hmac_ipad">HMAC_IPAD</a></h3>
<pre><code class="language-solidity">bytes32 constant HMAC_IPAD = 0x3636363636363636363636363636363636363636363636363636363636363636
</code></pre>
<h3 id="hmac_opad_xor_ipad"><a class="header" href="#hmac_opad_xor_ipad">HMAC_OPAD_XOR_IPAD</a></h3>
<pre><code class="language-solidity">bytes32 constant HMAC_OPAD_XOR_IPAD = 0x6a6a6a6a6a6a6a6a6a6a6a6a6a6a6a6a6a6a6a6a6a6a6a6a6a6a6a6a6a6a6a6a
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="solidity.min.js"></script>
        <script src="theme/pagetoc.js"></script>

        <script>
        window.addEventListener('load', function() {
            MathJax.Hub.Register.StartupHook('End', function() {
                window.setTimeout(window.print, 100);
            });
        });
        </script>


    </div>
    </body>
</html>
